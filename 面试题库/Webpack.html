<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | 沧海的雨季</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script>var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?87e6dfa24d2735e29aae05a54966e81";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();</script>
    <meta name="description" content="记录日常所得">
    
    <link rel="preload" href="/blog/assets/css/0.styles.cba9e905.css" as="style"><link rel="preload" href="/blog/assets/js/app.619266e3.js" as="script"><link rel="preload" href="/blog/assets/js/2.f827b574.js" as="script"><link rel="preload" href="/blog/assets/js/35.320e4046.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.eb082ef4.js"><link rel="prefetch" href="/blog/assets/js/11.011b8f72.js"><link rel="prefetch" href="/blog/assets/js/12.de0c73a8.js"><link rel="prefetch" href="/blog/assets/js/13.f3891566.js"><link rel="prefetch" href="/blog/assets/js/14.e6edf41f.js"><link rel="prefetch" href="/blog/assets/js/15.0f8c87b0.js"><link rel="prefetch" href="/blog/assets/js/16.0e185238.js"><link rel="prefetch" href="/blog/assets/js/17.af627ff1.js"><link rel="prefetch" href="/blog/assets/js/18.be4b0386.js"><link rel="prefetch" href="/blog/assets/js/19.c716c145.js"><link rel="prefetch" href="/blog/assets/js/20.4f2cf657.js"><link rel="prefetch" href="/blog/assets/js/21.f5ced15c.js"><link rel="prefetch" href="/blog/assets/js/22.29d8d088.js"><link rel="prefetch" href="/blog/assets/js/23.b0f94302.js"><link rel="prefetch" href="/blog/assets/js/24.336fb842.js"><link rel="prefetch" href="/blog/assets/js/25.c83972e0.js"><link rel="prefetch" href="/blog/assets/js/26.0f5b9dd8.js"><link rel="prefetch" href="/blog/assets/js/27.6450756a.js"><link rel="prefetch" href="/blog/assets/js/28.aa7cfb13.js"><link rel="prefetch" href="/blog/assets/js/29.7050fbfb.js"><link rel="prefetch" href="/blog/assets/js/3.19ec725d.js"><link rel="prefetch" href="/blog/assets/js/30.3d0031c4.js"><link rel="prefetch" href="/blog/assets/js/31.86b86a2b.js"><link rel="prefetch" href="/blog/assets/js/32.a512f247.js"><link rel="prefetch" href="/blog/assets/js/33.322fd299.js"><link rel="prefetch" href="/blog/assets/js/34.2da157ef.js"><link rel="prefetch" href="/blog/assets/js/36.af0b7a61.js"><link rel="prefetch" href="/blog/assets/js/37.f5f47eff.js"><link rel="prefetch" href="/blog/assets/js/38.7ee56679.js"><link rel="prefetch" href="/blog/assets/js/39.e64363a8.js"><link rel="prefetch" href="/blog/assets/js/4.f20e20c5.js"><link rel="prefetch" href="/blog/assets/js/40.d4abfce8.js"><link rel="prefetch" href="/blog/assets/js/41.87f2dd31.js"><link rel="prefetch" href="/blog/assets/js/5.90172067.js"><link rel="prefetch" href="/blog/assets/js/6.1468cce3.js"><link rel="prefetch" href="/blog/assets/js/7.73bbcdbb.js"><link rel="prefetch" href="/blog/assets/js/8.0368d0dc.js"><link rel="prefetch" href="/blog/assets/js/9.b1850208.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.cba9e905.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">沧海的雨季</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试题库" class="dropdown-title"><span class="title">面试题库</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试题库" class="mobile-dropdown-title"><span class="title">面试题库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/面试题库/面试真题2022.html" class="nav-link">
  面试真题2022
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/通信类.html" class="nav-link">
  通信类
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/HTML.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/CSS.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/JavaScript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/笔试题.html" class="nav-link">
  笔试题
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/Vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/Vue3.html" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/Webpack.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/Node.js.html" class="nav-link">
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/其它.html" class="nav-link">
  其它
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/vue的diff算法.html" class="nav-link">
  vue的diff算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用代码片段" class="dropdown-title"><span class="title">常用代码片段</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用代码片段" class="mobile-dropdown-title"><span class="title">常用代码片段</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/常用代码片段/CSS常用代码片段.html" class="nav-link">
  CSS常用代码片段
</a></li><li class="dropdown-item"><!----> <a href="/blog/常用代码片段/JS常用代码片段.html" class="nav-link">
  JS常用代码片段
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端笔记" class="dropdown-title"><span class="title">前端笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端笔记" class="mobile-dropdown-title"><span class="title">前端笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/前端笔记/深入理解 ES6.html" class="nav-link">
  深入理解ES6
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/正则表达式.html" class="nav-link">
  正则表达式
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/JavaScript正则迷你书.html" class="nav-link">
  JavaScript正则迷你书
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/JavaScript 设计模式核⼼原理与应⽤实践.html" class="nav-link">
  JavaScript 设计模式核⼼原理与应⽤实践
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/TypeScript.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/linux命令.html" class="nav-link">
  linux命令
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/HTTP协议原理+实践 Web开发工程师必学.html" class="nav-link">
  HTTP协议原理
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/图解HTTP.html" class="nav-link">
  图解HTTP
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/后台通用提效解决方案.html" class="nav-link">
  后台通用提效解决方案
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/vue使用.html" class="nav-link">
  Vue使用
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小程序" class="dropdown-title"><span class="title">小程序</span> <span class="arrow down"></span></button> <button type="button" aria-label="小程序" class="mobile-dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/小程序/微信小程序.html" class="nav-link">
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node.js" class="dropdown-title"><span class="title">Node.js</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node.js" class="mobile-dropdown-title"><span class="title">Node.js</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Node.js/Node.js从零开发Web Server博客项目 前端晋升全栈工程师必备.html" class="nav-link">
  Node.js从零开发Web Server博客项目
</a></li><li class="dropdown-item"><!----> <a href="/blog/Node.js/Node.js+KOA2 从0到1打造超好用Web框架一步到位 掌握KOA2服务端开发.html" class="nav-link">
  Node.js+KOA2 从0到1打造超好用Web框架一步到位
</a></li><li class="dropdown-item"><!----> <a href="/blog/Node.js/Vue全家桶+SSR+Koa2全栈开发美团网.html" class="nav-link">
  Vue全家桶+SSR+Koa2全栈开发美团网
</a></li><li class="dropdown-item"><!----> <a href="/blog/Node.js/Koa2新浪博客.html" class="nav-link">
  Koa2新浪博客
</a></li></ul></div></div> <a href="https://gitee.com/l544402029/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    gitee
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试题库" class="dropdown-title"><span class="title">面试题库</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试题库" class="mobile-dropdown-title"><span class="title">面试题库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/面试题库/面试真题2022.html" class="nav-link">
  面试真题2022
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/通信类.html" class="nav-link">
  通信类
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/HTML.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/CSS.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/JavaScript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/笔试题.html" class="nav-link">
  笔试题
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/Vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/Vue3.html" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/Webpack.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/Node.js.html" class="nav-link">
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/其它.html" class="nav-link">
  其它
</a></li><li class="dropdown-item"><!----> <a href="/blog/面试题库/vue的diff算法.html" class="nav-link">
  vue的diff算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用代码片段" class="dropdown-title"><span class="title">常用代码片段</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用代码片段" class="mobile-dropdown-title"><span class="title">常用代码片段</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/常用代码片段/CSS常用代码片段.html" class="nav-link">
  CSS常用代码片段
</a></li><li class="dropdown-item"><!----> <a href="/blog/常用代码片段/JS常用代码片段.html" class="nav-link">
  JS常用代码片段
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端笔记" class="dropdown-title"><span class="title">前端笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端笔记" class="mobile-dropdown-title"><span class="title">前端笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/前端笔记/深入理解 ES6.html" class="nav-link">
  深入理解ES6
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/正则表达式.html" class="nav-link">
  正则表达式
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/JavaScript正则迷你书.html" class="nav-link">
  JavaScript正则迷你书
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/JavaScript 设计模式核⼼原理与应⽤实践.html" class="nav-link">
  JavaScript 设计模式核⼼原理与应⽤实践
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/TypeScript.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/linux命令.html" class="nav-link">
  linux命令
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/HTTP协议原理+实践 Web开发工程师必学.html" class="nav-link">
  HTTP协议原理
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/图解HTTP.html" class="nav-link">
  图解HTTP
</a></li><li class="dropdown-item"><!----> <a href="/blog/前端笔记/后台通用提效解决方案.html" class="nav-link">
  后台通用提效解决方案
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/vue使用.html" class="nav-link">
  Vue使用
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小程序" class="dropdown-title"><span class="title">小程序</span> <span class="arrow down"></span></button> <button type="button" aria-label="小程序" class="mobile-dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/小程序/微信小程序.html" class="nav-link">
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node.js" class="dropdown-title"><span class="title">Node.js</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node.js" class="mobile-dropdown-title"><span class="title">Node.js</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Node.js/Node.js从零开发Web Server博客项目 前端晋升全栈工程师必备.html" class="nav-link">
  Node.js从零开发Web Server博客项目
</a></li><li class="dropdown-item"><!----> <a href="/blog/Node.js/Node.js+KOA2 从0到1打造超好用Web框架一步到位 掌握KOA2服务端开发.html" class="nav-link">
  Node.js+KOA2 从0到1打造超好用Web框架一步到位
</a></li><li class="dropdown-item"><!----> <a href="/blog/Node.js/Vue全家桶+SSR+Koa2全栈开发美团网.html" class="nav-link">
  Vue全家桶+SSR+Koa2全栈开发美团网
</a></li><li class="dropdown-item"><!----> <a href="/blog/Node.js/Koa2新浪博客.html" class="nav-link">
  Koa2新浪博客
</a></li></ul></div></div> <a href="https://gitee.com/l544402029/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    gitee
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpack" class="sidebar-link">Webpack</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpack-是什么" class="sidebar-link">Webpack 是什么？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#官方文档查阅" class="sidebar-link">官方文档查阅</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#搭建-webpack-环境" class="sidebar-link">搭建 Webpack 环境</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#使用-webpack-配置文件" class="sidebar-link">使用 Webpack 配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#创建配置文件" class="sidebar-link">创建配置文件</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#修改默认配置文件名字" class="sidebar-link">修改默认配置文件名字</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpack-执行命令" class="sidebar-link">webpack 执行命令</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#loader" class="sidebar-link">loader</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#打包静态资源-图片篇" class="sidebar-link">打包静态资源（图片篇）</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#打包静态资源-样式篇" class="sidebar-link">打包静态资源（样式篇）</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#使用-plugins" class="sidebar-link">使用 plugins</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#生成-html-文件" class="sidebar-link">生成 html 文件</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#打包时清空-dist-目录" class="sidebar-link">打包时清空 dist 目录</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#基础配置" class="sidebar-link">基础配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#entry" class="sidebar-link">Entry</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#output" class="sidebar-link">Output</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#sourcemap" class="sidebar-link">SourceMap</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpackdevserver" class="sidebar-link">WebpackDevServer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpack-watch" class="sidebar-link">webpack --watch</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#devserver" class="sidebar-link">devServer</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#热模块更新-hmr" class="sidebar-link">热模块更新（HMR）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#使用-babel-处理-es6-语法" class="sidebar-link">使用 Babel 处理 ES6 语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#业务代码" class="sidebar-link">业务代码</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#打包组件库" class="sidebar-link">打包组件库</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#配置-react-代码打包" class="sidebar-link">配置 React 代码打包</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#tree-shaking" class="sidebar-link">Tree Shaking</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#develoment-和-production-模式的区分打包" class="sidebar-link">Develoment 和 Production 模式的区分打包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#开发环境" class="sidebar-link">开发环境</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#线上环境" class="sidebar-link">线上环境</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#公共文件" class="sidebar-link">公共文件</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpack-和-code-splitting" class="sidebar-link">Webpack 和 Code Splitting</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#自动进行代码分割" class="sidebar-link">自动进行代码分割</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#splitchunksplugin-配置参数详解" class="sidebar-link">SplitChunksPlugin 配置参数详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#魔法注释" class="sidebar-link">魔法注释</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#参数说明" class="sidebar-link">参数说明</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#chunks-是什么" class="sidebar-link">Chunks 是什么？</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#lazy-loading-懒加载" class="sidebar-link">Lazy Loading 懒加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#打包分析" class="sidebar-link">打包分析</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#preloading-prefetching" class="sidebar-link">Preloading, Prefetching</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#css-代码分割" class="sidebar-link">css 代码分割</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpack-与浏览器缓存" class="sidebar-link">Webpack 与浏览器缓存</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#shimming-的作用" class="sidebar-link">Shimming 的作用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#模块内-this-指向-window" class="sidebar-link">模块内 this 指向 window</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#环境变量" class="sidebar-link">环境变量</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#打包组件库-2" class="sidebar-link">打包组件库</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#pwa-的打包配置" class="sidebar-link">PWA 的打包配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#安装插件模拟服务器" class="sidebar-link">安装插件模拟服务器</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#typescript-的打包配置" class="sidebar-link">TypeScript 的打包配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpackdevserver-2" class="sidebar-link">WebpackDevServer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#请求转发" class="sidebar-link">请求转发</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#解决单页面应用路由问题" class="sidebar-link">解决单页面应用路由问题</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#eslint" class="sidebar-link">EsLint</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#使用-eslint-检测代码" class="sidebar-link">使用 eslint 检测代码</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#vscode-中的-eslint" class="sidebar-link">vscode 中的 ESlint</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#最佳实践-2" class="sidebar-link">最佳实践</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpack-性能优化" class="sidebar-link">webpack 性能优化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#多页面打包配置" class="sidebar-link">多页面打包配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#如何编写一个-loader" class="sidebar-link">如何编写一个 loader</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#如何编写一个-plugin" class="sidebar-link">如何编写一个 Plugin</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#bundler-源码编写" class="sidebar-link">Bundler 源码编写</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#模块分析" class="sidebar-link">模块分析</a></li></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#vue-cli-3-的配置方法" class="sidebar-link">Vue CLI 3 的配置方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#实现小型打包工具" class="sidebar-link">实现小型打包工具</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#如何配置别名" class="sidebar-link">如何配置别名</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#常见面试题总结" class="sidebar-link">常见面试题总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#module-chunk-bundle-分别什么意思-有何区别" class="sidebar-link">module chunk bundle 分别什么意思，有何区别?</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpack-常见性能优化-综合" class="sidebar-link">webpack 常见性能优化 - 综合</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpack-常见性能优化-构建速度" class="sidebar-link">webpack 常见性能优化 - 构建速度</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpack-性能优化-产出代码" class="sidebar-link">webpack 性能优化 - 产出代码</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#前端代码为何要进行构建和打包" class="sidebar-link">前端代码为何要进行构建和打包?</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#plugin-与-loader-的区别-2" class="sidebar-link">Plugin 与 loader 的区别？</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#常见-loader-有哪些" class="sidebar-link">常见 loader 有哪些？</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#常见-plugin-有哪些" class="sidebar-link">常见 plugin 有哪些？</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#babel-和-webpack-的区别" class="sidebar-link">babel 和 webpack 的区别</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#babel-polyfill-和-babel-runtime-的区别" class="sidebar-link">babel-polyfill 和 babel-runtime 的区别？</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#webpack-如何实现懒加载" class="sidebar-link">webpack 如何实现懒加载？</a></li><li class="sidebar-sub-header"><a href="/blog/%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93/Webpack.html#为何-proxy-不能被-polyfill" class="sidebar-link">为何 Proxy 不能被 Polyfill？</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h2> <div class="language- extra-class"><pre class="language-text"><code>本篇博客由慕课网视频[从基础到实战手把手带你掌握新版Webpack4.0](https://coding.imooc.com/class/316.html)阅读整理而来，观看视频请支持正版。
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>本篇博客 Webpack 版本是4.0+，请确保你安装了Node.js最新版本。
</code></pre></div><h2 id="webpack-是什么"><a href="#webpack-是什么" class="header-anchor">#</a> Webpack 是什么？</h2> <h5 id="核心定义"><a href="#核心定义" class="header-anchor">#</a> 核心定义</h5> <p>webpack 的核心定义是一个模块打包工具。</p> <h3 id="官方文档查阅"><a href="#官方文档查阅" class="header-anchor">#</a> 官方文档查阅</h3> <p><a href="https://webpack.js.org/concepts/" target="_blank" rel="noopener noreferrer">https://webpack.js.org/concepts/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>GUIDES: 解决某一个方向问题答案，如代码分割，TypeScript</p> <p>CONCEPTS： 一些核心的概念</p> <p>CONFIGURATION： 某个配置项</p> <p>API： 写一些 loader，plugin 插件</p> <p>LOADERS： 查看 loader 的作用，配置。（如果找不到到插件的 githup 上找）</p> <p>PLUGINS： 插件的作用，配置。（如果找不到到插件的 githup 上找）</p> <h3 id="搭建-webpack-环境"><a href="#搭建-webpack-环境" class="header-anchor">#</a> 搭建 Webpack 环境</h3> <p>首先要安装 node.js 以及 npm， 并保证是最新版本。（最新版本会加快打包构建速度）</p> <h4 id="安装指令"><a href="#安装指令" class="header-anchor">#</a> 安装指令</h4> <p>全局安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> webpack webpack-cli -g
</code></pre></div><p>项目安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> webpack webpack-cli -D
</code></pre></div><p>带有版本的安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> webpack@4.16.5 webpack-cli -D
</code></pre></div><h4 id="卸载指令"><a href="#卸载指令" class="header-anchor">#</a> 卸载指令</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> uninstall webpack webpack-cli -g
</code></pre></div><h4 id="查看当前-webpack-版本"><a href="#查看当前-webpack-版本" class="header-anchor">#</a> 查看当前 Webpack 版本</h4> <p>全局安装查看指令：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>webpack -v
</code></pre></div><p>项目内安装查看指令：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>npx webpack  -v
</code></pre></div><h4 id="查看历史-webpack-版本"><a href="#查看历史-webpack-版本" class="header-anchor">#</a> 查看历史 Webpack 版本</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> info webpack
</code></pre></div><h2 id="使用-webpack-配置文件"><a href="#使用-webpack-配置文件" class="header-anchor">#</a> 使用 Webpack 配置文件</h2> <h3 id="创建配置文件"><a href="#创建配置文件" class="header-anchor">#</a> 创建配置文件</h3> <p>在根目录创建<code>webpack.config.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//引入node核心模块</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//mode: 'production',//默认模式,会压缩代码，不写即是默认，不写会有提示</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span> <span class="token comment">//开发模式， 不会压缩代码</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//从哪一个文件开始打包</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//输出到哪里</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//输出的文件名称</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;bundle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//输出到哪一个文件夹下, path后面跟绝对路径</span>
    <span class="token comment">//__dirname指的是webpack.config.js文件当前所在的路径</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="修改默认配置文件名字"><a href="#修改默认配置文件名字" class="header-anchor">#</a> 修改默认配置文件名字</h3> <p>把默认的<code>webpack.config.js</code>， 修改为<code>webpackconfig.js</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>npx webpack --config webpackconfig.js
</code></pre></div><blockquote><p>npx 会在目录下的 node_modules 下面找 webpack，没有就安装一个。npm 则先去全局，然后再去当前目录下的 node_modules 找 webpack，没有就不找了</p></blockquote> <h3 id="webpack-执行命令"><a href="#webpack-执行命令" class="header-anchor">#</a> webpack 执行命令</h3> <ul><li>全局(global)</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>webpack index.js
</code></pre></div><ul><li>局部（local）</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>npx webpack index.js
</code></pre></div><ul><li>修改后脚本执行命令（<code>npm scripts</code>）</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> run bundle
</code></pre></div><p>package.json 文件</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-demo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;bundle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LiuJunFeng&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.41.5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.10&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="loader"><a href="#loader" class="header-anchor">#</a> loader</h2> <p>loader 是一个打包方案，它知道对于某一个特定的文件，webpack 该如何进行打包。本身 webpack 是不知道对于一些文件（jpg，txt，excel）该如何处理的，但是 loader 知道。 所以 webpack 去求助 loader 就可以啦。</p> <h3 id="打包静态资源-图片篇"><a href="#打包静态资源-图片篇" class="header-anchor">#</a> 打包静态资源（图片篇）</h3> <h4 id="安装插件"><a href="#安装插件" class="header-anchor">#</a> 安装插件</h4> <p>打包图片资源可以选用两个<code>loader</code>， 一个是<code>file-loader</code>，一个是<code>url-loader</code>。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i file-loader -D
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i url-loader -D
</code></pre></div><p>url-loader 更加友好， 它可以通过图片大小来判断是使用 base64 格式图片还是直接打包成一个图片资源文件。</p> <h4 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h4> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpg|png|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// loader: 'file-loader',// 遇到jpg格式不知道怎么打包就去求助file-loader插件</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span> <span class="token comment">//图片转化为base64， 不是单独生成一个文件。</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// placeholder 占位符</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name]_[hash].[ext]&quot;</span><span class="token punctuation">,</span> <span class="token comment">//name 打包文件名字   name/原有文件名字  hash/本次打包哈希值  ext/原有名字后缀</span>
          <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&quot;images/&quot;</span><span class="token punctuation">,</span> <span class="token comment">//把图片文件打包到images目录下</span>
          <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">204800</span><span class="token punctuation">,</span> <span class="token comment">//如果文件超过204800字节，就会像file-loader打包到dist目录下生成一个文件，</span>
          <span class="token comment">//如果文件小于204800字节，那就回变成base64字符串， 放到js内</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h4> <p>File-loader 底层处理逻辑，先将文件转移到打包目录下，再将 dist 中的文件路径返回给 index.js。</p> <p>任何的静态文件都可以使用<code>file-loader</code>插件， 只要你希望把静态文件移动到打包目录下并且获取到此文件地址。</p> <h3 id="打包静态资源-样式篇"><a href="#打包静态资源-样式篇" class="header-anchor">#</a> 打包静态资源（样式篇）</h3> <h4 id="安装插件-2"><a href="#安装插件-2" class="header-anchor">#</a> 安装插件</h4> <h5 id="css-文件打包"><a href="#css-文件打包" class="header-anchor">#</a> css 文件打包</h5> <p>打包<code>css</code>文件需要使用两个<code>loader</code>，<code>style-loader</code>和<code>css-loader</code>。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i style-loader css-loader -D
</code></pre></div><p><code>css-loader</code>帮我们分析出几个 css 文件的引入关系， 最终将这些 css 文件合并成一段 css。</p> <p><code>style-loader</code> 再得到<code>css-loader</code>生成的内容后， 会把这段代码挂载到 html 的 head 部分。</p> <p>在打包 css 文件时， 一定要<code>css-loader</code>和<code>style-loader</code>配合使用。</p> <h5 id="sass-文件打包"><a href="#sass-文件打包" class="header-anchor">#</a> sass 文件打包</h5> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> sass-loader node-sass --save-dev
</code></pre></div><h5 id="自动加厂商前缀"><a href="#自动加厂商前缀" class="header-anchor">#</a> 自动加厂商前缀</h5> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i -D postcss-loader
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i autoprefixer -D
</code></pre></div><p>loader 打包的执行顺序是从下到上（从右到左）来执行， 如下：sass 文件会先执行<code>sass-loader</code>， 处理完后再执行<code>style-loader</code>挂载到 html 的 head 部分。</p> <h4 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h4> <p>webpack.config.js</p> <p>在 module 对象内的 rule 数组内添加以下代码：</p> <p>css 样式文件配置</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                  <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//在scss又引入另外一个scss时，有可能直接走css-loader，不走sass-loader和postcss-loader，加上此配置项可以让它继续走下面两个loader</span>
                        <span class="token comment">//modules: true//开启css模块化打包  解决全局样式冲突</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">'sass-loader'</span><span class="token punctuation">,</span><span class="token comment">//sass文件编译</span>
                <span class="token string">'postcss-loader'</span><span class="token comment">//加厂商前缀</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>字体文件配置</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(eot|ttf|woff|woff2|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">'fonts/'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>如果需要加厂商前缀， 需要在根目录在创建一个文件， 取名为<code>postcss.config.js</code>, 以下为具体配置：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;autoprefixer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>默认打包支持的浏览器，不需要厂商前缀，可以把浏览器条件放宽：</p> <p>可以在根目录<code>package.json</code>文件中添加浏览器条件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string-property property">&quot;browserslist&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;&gt; 1%&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;last 2 versions&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;not ie &lt;= 8&quot;</span>
  <span class="token punctuation">]</span>
</code></pre></div><h2 id="使用-plugins"><a href="#使用-plugins" class="header-anchor">#</a> 使用 plugins</h2> <p>plugin 可以在 webpack 运行到某个时刻的时候， 帮你做一些事情。 很像 vue 中的生命周期函数。</p> <h3 id="生成-html-文件"><a href="#生成-html-文件" class="header-anchor">#</a> 生成 html 文件</h3> <h4 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i -D html-webpack-plugin
</code></pre></div><p>html-webpack-plugin 会在打包结束的时刻， 自动生成一个 html 文件， 并把打包生成的 js 自动注入到这个 html 文件中。</p> <h4 id="配置-2"><a href="#配置-2" class="header-anchor">#</a> 配置</h4> <p>首先需要引入该插件， 然后再<code>module</code>对象内写入<code>plugins</code>属性名， 属性是一个数组，数组内实例化该插件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="打包时清空-dist-目录"><a href="#打包时清空-dist-目录" class="header-anchor">#</a> 打包时清空 dist 目录</h3> <h4 id="安装-2"><a href="#安装-2" class="header-anchor">#</a> 安装</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i clean-webpack-plugin -D
</code></pre></div><p><code>clean-webpack-plugin</code> 插件会在打包流程执行前清空 dist 目录</p> <p><a name="224e2ccd-2"></a></p> <h4 id="配置-3"><a href="#配置-3" class="header-anchor">#</a> 配置</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="基础配置"><a href="#基础配置" class="header-anchor">#</a> 基础配置</h2> <h3 id="entry"><a href="#entry" class="header-anchor">#</a> Entry</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
       <span class="token literal-property property">sub</span><span class="token operator">:</span><span class="token string">'./src/index.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//从哪一个文件开始打包</span>
</code></pre></div><p>如果一个文件打包两次， 可以用以上方式配置， 一个文件会成为 main.js， 一个会成为 sub.js。</p> <h3 id="output"><a href="#output" class="header-anchor">#</a> Output</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//输出到哪里</span>
        <span class="token literal-property property">publicPath</span><span class="token operator">:</span><span class="token string">'http://cdn.com.cn'</span><span class="token punctuation">,</span><span class="token comment">//文件使用cdn域名</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span><span class="token comment">//输出的文件名称  name对应的是entry里的key值</span>
		<span class="token literal-property property">chunkFilename</span><span class="token operator">:</span><span class="token string">'[name].chunk.js'</span><span class="token punctuation">,</span><span class="token comment">//间接引入的文件会加上.chunk</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span> <span class="token comment">//输出到哪一个文件夹下, path后面跟绝对路径</span>
        <span class="token comment">//__dirname指的是webpack.config.js文件当前所在的路径</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="sourcemap"><a href="#sourcemap" class="header-anchor">#</a> SourceMap</h2> <p>可以使用这个配置查看源代码那里有错误， 而不是打包后的文件错误。</p> <p>比如你的 js 文件里面写的有问题，比如 dist 目录下的 main.js 文件第 96 行出错。SourceMap 他是一个映射关系， 他知道 dist 目录下的 main.js 文件 96 行实际上对应的是 src 目录下 index.js 文件中的第一行。他就知道是 index.js 第一行出错了。</p> <h4 id="配置-4"><a href="#配置-4" class="header-anchor">#</a> 配置</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//mode: 'production',//默认模式,会压缩代码，不写即是默认，不写会有提示</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span><span class="token comment">//开发模式， 不会压缩代码</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span><span class="token string">'source-map'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//从哪一个文件开始打包</span>
</code></pre></div><p><code>devtool:'inline-source-map'</code></p> <p>source-map 会在 dist 目录下生成一个 main.js.map，   而使用 inline-source-map 会直接通过 data-url 的方式直接写在 main.js 内的底部。</p> <p><code>devtool:'cheap-inline-source-map'</code></p> <p>当我们遇到代码量很大的时候， 如果我们的代码出了错误， 加上 cheap 它就会只告诉我们是哪一行出了错误， 而不会告诉我们第几列。   打包会更加节省性能。</p> <p><code>devtool:'cheap-module-inline-source-map'</code></p> <p>source-map 只会告诉我们业务相关的代码是否有错， 而不会告诉我们引入第三方模块代码是否有错误， 比如 loader 内的错误。如果你想让它也管第三方模块的错误可以加上 module。</p> <p><code>devtool:'eval',</code></p> <p>使用<code>eval</code>配置执行效率最快， 性能最好的打包方式。它使用了<code>eval</code>的语法执行源代码。但是如果比较复杂的代码情况下， 它提示出来的内容可能不太准确。</p> <h5 id="最佳实践"><a href="#最佳实践" class="header-anchor">#</a> 最佳实践</h5> <p>如果你在开发环境中， 使用 source-map 建议使用<code>devtool:'cheap-module-inline-eval-source-map'</code>, 它提示出来的错误是比较全的， 同时它的打包速度也是比较快的。</p> <p>如果在线上环境中， 没必要使用 source-map 作为映射， 直接删除此配置即可。</p> <p>当然如果你也需要看错误提示， 可以使用<code>devtool:'cheap-module-source-map'。</code>它的提示会更好一些。</p> <h2 id="webpackdevserver"><a href="#webpackdevserver" class="header-anchor">#</a> WebpackDevServer</h2> <p>修改源码自动就会进行打包。提升开发效率。</p> <p>总共有以下两种方式：</p> <h3 id="webpack-watch"><a href="#webpack-watch" class="header-anchor">#</a> webpack --watch</h3> <p>监听文件改动实时进行打包</p> <p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --watch&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="devserver"><a href="#devserver" class="header-anchor">#</a> devServer</h3> <p>自动打包并刷新浏览器，还可以模拟服务器上的特性。 vue 以及 react 脚手架使用的都是此配置。推荐使用， 这个也是业界最经常使用的方案。</p> <h4 id="安装插件-3"><a href="#安装插件-3" class="header-anchor">#</a> 安装插件</h4> <div class="language- extra-class"><pre class="language-text"><code>npm i webpack-dev-server -D
</code></pre></div><h4 id="配置-5"><a href="#配置-5" class="header-anchor">#</a> 配置</h4> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span><span class="token comment">//服务器起在哪一个文件夹下</span>
        <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//自动打开浏览器</span>
        <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span><span class="token comment">//使用哪个端口号</span>
        <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">'./api'</span><span class="token operator">:</span><span class="token string">'http://locallhost:3000'</span>
        <span class="token punctuation">}</span><span class="token comment">//如果访问api这个地址，也就是locallhost:8000/api, 它会帮你转发到http://locallhost:3000这个地址上</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --watch&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="热模块更新-hmr"><a href="#热模块更新-hmr" class="header-anchor">#</a> 热模块更新（HMR）</h2> <p>HMR 是 Hot Module Replacement 的缩写。</p> <p>它可以只更新你改动的文件， 不会直接刷新浏览器。</p> <p>优点：</p> <ol><li>非常方便调试样式。</li></ol> <h4 id="配置-6"><a href="#配置-6" class="header-anchor">#</a> 配置</h4> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span><span class="token comment">//服务器起在哪一个文件夹下</span>
        <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//自动打开浏览器</span>
        <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span><span class="token comment">//使用哪个端口号</span>
        <span class="token comment">// proxy: {</span>
        <span class="token comment">//     './api':'http://locallhost:3000'</span>
        <span class="token comment">// }//如果访问api这个地址，也就是locallhost:8000/api, 它会帮你转发到http://locallhost:3000这个地址上</span>
        <span class="token literal-property property">hot</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//开启热更新</span>
        <span class="token literal-property property">hotOnly</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token comment">//即便热更新没有生效，也不刷新浏览器</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;src/index.html&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>index.js 内</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/peizhiwenj.png" alt="输入图片说明"></p> <p>如果开启热更新， number.js 文件只要发生变化就会重新执行一下</p> <h2 id="使用-babel-处理-es6-语法"><a href="#使用-babel-处理-es6-语法" class="header-anchor">#</a> 使用 Babel 处理 ES6 语法</h2> <h3 id="业务代码"><a href="#业务代码" class="header-anchor">#</a> 业务代码</h3> <h4 id="安装插件-4"><a href="#安装插件-4" class="header-anchor">#</a> 安装插件</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i -D babel-loader @babel/core

<span class="token function">npm</span> i @babel/preset-env -D

<span class="token function">npm</span> i --save @babel/polyfill
</code></pre></div><p>babel-loader 插件只是作为 babel 与 webpack 沟通的桥梁， 如果想要翻译 ES6 语法， 需要安装@babel/preset-env 插件。</p> <p>babel/polyfill 用来补充 babel/preset-env 的， 有的语法 babel/preset-env 不能翻译（如 Promise）， 这时候可以使用 babel/polyfill。</p> <h4 id="配置-7"><a href="#配置-7" class="header-anchor">#</a> 配置</h4> <p>在业务代码 js 的顶部引入 babel/polyfill 。如果使用了<code>useBuiltIns:&quot;usage&quot;</code>，也可以不引入此插件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//js文件由ES6转成ES5</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//不管这个文件夹下的js文件</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
              <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">edge</span><span class="token operator">:</span> <span class="token string">&quot;17&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">firefox</span><span class="token operator">:</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">chrome</span><span class="token operator">:</span> <span class="token string">&quot;67&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">safari</span><span class="token operator">:</span> <span class="token string">&quot;11.1&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//浏览器版本，如chrome版本大于67将不会翻译成ES5</span>
              <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span><span class="token string">&quot;usage&quot;</span><span class="token comment">//js里用哪个翻译那个，不用的语法特性不会翻译, 减少文件体积</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
</code></pre></div><h3 id="打包组件库"><a href="#打包组件库" class="header-anchor">#</a> 打包组件库</h3> <p>如果开发组件库或者第三方模块的时候， 不要使用@babel/polyfill 插件。因为它在注入 promise 或者 map 方法的时候， 它会通过全局变量的方式注入， 会污染到全局环境。</p> <h4 id="安装插件-5"><a href="#安装插件-5" class="header-anchor">#</a> 安装插件</h4> <p>我们可以换一种方式：</p> <p>首先把业务代码中引入的@babel/polyfill 注释掉， 然后按照 @babel/plugin-transform-runtime 和@babel/runtime 插件。</p> <div class="language-shell extra-class"><pre class="language-shell"><code> <span class="token function">npm</span> i -D @babel/plugin-transform-runtime
 <span class="token function">npm</span> i --save @babel/runtime
  <span class="token function">npm</span> i --save @babel/runtime-corejs2
</code></pre></div><h4 id="配置-8"><a href="#配置-8" class="header-anchor">#</a> 配置</h4> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//js文件由ES6转成ES5</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//不管这个文件夹下的js文件</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
              <span class="token string-property property">&quot;corejs&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;helpers&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;regenerator&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;useESModules&quot;</span><span class="token operator">:</span><span class="token boolean">false</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
</code></pre></div><p>如果 plugins 内 corejs 配置了 2， 那么就要安装@babel/runtime-corejs2 这个插件了。</p> <p>当然， 在我们配置过多的 babel 配置时， 也可以在根目录创建一个.babelrc 文件。用来放置相关配置， 如下：</p> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//js文件由ES6转成ES5</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//不管这个文件夹下的js文件</span>
		<span class="token comment">//include: path.resolve(__dirname,'../src')//只对src目录的js文件打包</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span>
      <span class="token punctuation">}</span>
</code></pre></div><p>babelrc</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;helpers&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;regenerator&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;useESModules&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="配置-react-代码打包"><a href="#配置-react-代码打包" class="header-anchor">#</a> 配置 React 代码打包</h2> <h4 id="安装插件-6"><a href="#安装插件-6" class="header-anchor">#</a> 安装插件</h4> <div class="language-shell extra-class"><pre class="language-shell"><code> <span class="token function">npm</span> i react react-dom --save
 <span class="token function">npm</span> i --save-dev @babel/preset-react
</code></pre></div><h4 id="配置-9"><a href="#配置-9" class="header-anchor">#</a> 配置</h4> <p>babelrl</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;edge&quot;</span><span class="token operator">:</span> <span class="token string">&quot;17&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;firefox&quot;</span><span class="token operator">:</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;chrome&quot;</span><span class="token operator">:</span> <span class="token string">&quot;67&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;safari&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11.1&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;useBuiltIns&quot;</span><span class="token operator">:</span> <span class="token string">&quot;usage&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@babel/preset-react&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>这个执行顺序是按照从下到上，从右到左来执行的。顺序一定不要写反了。它是先执行react转成js， 然后执行babel转成ES5的。
</code></pre></div><h2 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> Tree Shaking</h2> <div class="language- extra-class"><pre class="language-text"><code>Tree Shaking支持ES6的Module引入方式，它只支持静态引入的方式， 动态引入的方式它不支持。
</code></pre></div><p>Tree Shaking 中文翻译是摇树的意思， 大意就是把无效的代码摇晃掉， 只留下有用的代码。<br>比如你引入了一个模块中的方法， 它就只打包你引入的方法， 不需要的方法不会进行打包了。</p> <p>在开发环境中， 是没有 Tree Shaking 功能的， 如果需要请添加以下配置：</p> <p>webpack.config.js</p> <p>在线上环境中可以不配置这个</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token literal-property property">optimization</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">usedExports</span><span class="token operator">:</span><span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//输出到哪里</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//输出的文件名称  name对应的是entry里的key值</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span> <span class="token comment">//输出到哪一个文件夹下, path后面跟绝对路径</span>
    <span class="token comment">//__dirname指的是webpack.config.js文件当前所在的路径</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>package.json 文件内</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-demo&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/polly-fill&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</code></pre></div><p>配置<code>&quot;sideEffects&quot;: [&quot;@babel/polly-fill&quot;]</code>,后， Tree Shaking 不会对这个插件有任何作用了。</p> <p>当然没有引用<code>@babel/polly-fill</code>也可以设置为<code>false</code>。</p> <p>如果你的业务 js 代码引入了 js，如下：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220808175242375.png" alt="image-20220808175242375"></p> <p>你也需要在&quot;sideEffects&quot;进行配置， 一般我们会对 css 文件进行以下配置：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string-property property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;*.css&quot;</span>
  <span class="token punctuation">]</span>
</code></pre></div><p>只要遇到任何的 css 文件，那么也不要去使用 Tree Shaking。</p> <h2 id="develoment-和-production-模式的区分打包"><a href="#develoment-和-production-模式的区分打包" class="header-anchor">#</a> Develoment 和 Production 模式的区分打包</h2> <p>在开发环境可以方便我们开发， 有热模块更新 DevServer 等配置可以更加方便我们的调试代码。</p> <p>而线上环境会压缩代码， 对<code>source-map</code>精简（没有报错信息或者只显示行错误）。</p> <h3 id="开发环境"><a href="#开发环境" class="header-anchor">#</a> 开发环境</h3> <p>首先我们需要把 webpack.config.js 修改为 webpack.dev.js， 表示开发环境。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//引入node核心模块</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//mode: 'production',//默认模式,会压缩代码，不写即是默认，不写会有提示</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span> <span class="token comment">//开发模式， 不会压缩代码</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;cheap-module-eval-source-map&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//从哪一个文件开始打包</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">,</span> <span class="token comment">//服务器起在哪一个文件夹下</span>
    <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//自动打开浏览器</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span> <span class="token comment">//使用哪个端口号</span>
    <span class="token comment">// proxy: {</span>
    <span class="token comment">//     './api':'http://locallhost:3000'</span>
    <span class="token comment">// }//如果访问api这个地址，也就是locallhost:8000/api, 它会帮你转发到http://locallhost:3000这个地址上</span>
    <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//开启热更新</span>
    <span class="token literal-property property">hotOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//即便热更新没有生效，也不刷新浏览器</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpg|png|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// loader: 'file-loader',// 遇到jpg格式不知道怎么打包就去求助file-loader插件</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span> <span class="token comment">//图片转化为base64， 不是单独生成一个文件。</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// placeholder 占位符</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name]_[hash].[ext]&quot;</span><span class="token punctuation">,</span> <span class="token comment">//name 打包文件名字   name/原有文件名字  hash/本次打包哈希值  ext/原有名字后缀</span>
            <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&quot;images/&quot;</span><span class="token punctuation">,</span> <span class="token comment">//把图片文件打包到images目录下</span>
            <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">204800</span><span class="token punctuation">,</span> <span class="token comment">//如果文件超过204800字节，就会像file-loader打包到dist目录下生成一个文件，</span>
            <span class="token comment">//如果文件小于204800字节，那就回变成base64字符串， 放到js内</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(eot|ttf|woff|woff2|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&quot;fonts/&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//在scss又引入另外一个scss时，有可能直接走css-loader，不走sass-loader和postcss-loader，加上此配置项可以让它继续走下面两个loader</span>
              <span class="token comment">//modules: true//开启css模块化打包  解决全局样式冲突</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&quot;sass-loader&quot;</span><span class="token punctuation">,</span> <span class="token comment">//sass文件编译</span>
          <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span> <span class="token comment">//加厂商前缀</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span> <span class="token comment">//加厂商前缀</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//js文件由ES6转成ES5</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//不管这个文件夹下的js文件</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;src/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">usedExports</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//输出到哪里</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//输出的文件名称  name对应的是entry里的key值</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//输出到哪一个文件夹下, path后面跟绝对路径</span>
    <span class="token comment">//__dirname指的是webpack.config.js文件当前所在的路径</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="启动命令"><a href="#启动命令" class="header-anchor">#</a> 启动命令</h4> <p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --config wepack.dev.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>在开发环境内也可以把 hotOnly: true 去掉， 使浏览器能自动刷新。</p> <h3 id="线上环境"><a href="#线上环境" class="header-anchor">#</a> 线上环境</h3> <p>然后创建 webpack.prod.js 文件， 表示线上环境。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;cheap-module-source-map&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpg|png|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name]_[hash].[ext]&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&quot;images/&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">204800</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(eot|ttf|woff|woff2|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&quot;fonts/&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&quot;sass-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;src/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="启动命令-2"><a href="#启动命令-2" class="header-anchor">#</a> 启动命令</h4> <p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --config wepack.dev.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span><span class="token string">&quot;webpack --config webpack.prod.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>打包完成后把 dist 文件夹丢给后端使用即可。</p> <h3 id="公共文件"><a href="#公共文件" class="header-anchor">#</a> 公共文件</h3> <p>我们可以发现在 webpack.dev.js 和 webpack.prod.js 中有很多相同代码， 这时候我们可以把相同的代码抽离出来放到 webpack.common.js 中。</p> <p>我们需要引入一个插件合并 common 文件与 prod 或者 dev 文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i webpack-merge -D
</code></pre></div><p>创建 webpack.common.js, 相同代码放入此文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpg|png|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name]_[hash].[ext]&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&quot;images/&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">204800</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(eot|ttf|woff|woff2|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&quot;fonts/&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&quot;sass-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;src/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack.dev.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.common.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;cheap-module-eval-source-map&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hotOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">usedExports</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack.prod.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.common.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;cheap-module-source-map&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当然， 如果我们这几个配置文件放在了根目录的 build 文件夹内， 你需要在 package.json 内对指令进行更改，把目录需要更改到 build 目录下</p> <p>package.json</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --config ./build/webpack.dev.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config ./build/webpack.prod.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>当然， 输出的目录也需要修改一下</p> <p>webpack.common.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dist&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="webpack-和-code-splitting"><a href="#webpack-和-code-splitting" class="header-anchor">#</a> Webpack 和 Code Splitting</h3> <p>Code Splitting 指的是代码分割。如果我们不使用代码分割，打包出来的文件会很大， 加载时间会很长。还有一种情况， 我们引入一个 lodash 库， 这部分代码不变， 仅仅是业务代码改变了， 如果我们再次打包就会全部又加载一遍， 影响了加载的速度。 我们希望的是 lodash 库不需要再次加载。</p> <p>我们先安装一个插件 lodash</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i lodash --save
</code></pre></div><p>src 目录创建一个 lodash.js 文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">&quot;lodash&quot;</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>_ <span class="token operator">=</span> _<span class="token punctuation">;</span>
</code></pre></div><p>webpack.common.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">lodash</span><span class="token operator">:</span> <span class="token string">&quot;./src/lodash.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="自动进行代码分割"><a href="#自动进行代码分割" class="header-anchor">#</a> 自动进行代码分割</h3> <h4 id="同步代码方式"><a href="#同步代码方式" class="header-anchor">#</a> 同步代码方式</h4> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/tonghbudaimafasngshi.png" alt="输入图片说明"></p> <p>以上为同步引入方式，可按照一下代码进行配置：</p> <p>webpack.common.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>这段代码能帮你做代码分割。</p> <h4 id="异步代码"><a href="#异步代码" class="header-anchor">#</a> 异步代码</h4> <p>异步引入指的是以下情况：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/yibudairu.png" alt="输入图片说明"></p> <h5 id="安装插件-7"><a href="#安装插件-7" class="header-anchor">#</a> 安装插件</h5> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i babel-plugin-dynamic-import-webpack
</code></pre></div><p>.babelrc</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;edge&quot;</span><span class="token operator">:</span> <span class="token string">&quot;17&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;firefox&quot;</span><span class="token operator">:</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;chrome&quot;</span><span class="token operator">:</span> <span class="token string">&quot;67&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;safari&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11.1&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;useBuiltIns&quot;</span><span class="token operator">:</span> <span class="token string">&quot;usage&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@babel/preset-react&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dynamic-import-webpack&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h4> <p>代码分割，和 webpack 无关</p> <p>webpack 中实现代码分割，两种方式</p> <ol><li>同步代码： 只需要在 webpack.common.js 中做 optimization 的配置即可</li> <li>异步代码(import): 异步代码，无需做任何配置，会自动进行代码分割，放置到新的文件中</li></ol> <h2 id="splitchunksplugin-配置参数详解"><a href="#splitchunksplugin-配置参数详解" class="header-anchor">#</a> SplitChunksPlugin 配置参数详解</h2> <h3 id="魔法注释"><a href="#魔法注释" class="header-anchor">#</a> 魔法注释</h3> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220808175400125.png" alt="image-20220808175400125"></p> <p>需要在 package.json 去掉 babel-plugin-dynamic-import-webpack 插件，因为它是一个第三方的插件，不支持魔法注释， 我们需要一个官方的插件来进行魔法注释。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i -D @babel/plugin-syntax-dynamic-import
</code></pre></div><p>.babelrc</p> <p>plugins 修改为 babel/plugin-syntax-dynamic-import</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token string-property property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>webpack.common.js</p> <p>如果 optimization 不写任何内容， 只是一个空对象， 会按照以下默认配置打包：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'aysnc'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token literal-property property">automaticNameDelimiter</span><span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>一般按照这个选项配置即可：</p> <p>webpack.common.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="参数说明"><a href="#参数说明" class="header-anchor">#</a> 参数说明</h3> <h4 id="chunks"><a href="#chunks" class="header-anchor">#</a> chunks</h4> <h5 id="chunks-async"><a href="#chunks-async" class="header-anchor">#</a> chunks: 'async'</h5> <p>默认配置是 async</p> <p>只对异步引入进行代码分割</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220808175424862.png" alt="image-20220808175424862"></p> <h5 id="chunks-initial"><a href="#chunks-initial" class="header-anchor">#</a> chunks: 'initial'</h5> <p>只对同步引入进行代码分割</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220808175441749.png" alt="image-20220808175441749"></p> <h5 id="chunks-all"><a href="#chunks-all" class="header-anchor">#</a> chunks: 'all'</h5> <p>全部都会进行代码分割，同时必须要配置 defaultVendors</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">defaultVendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
 <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
 <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行过程是首先看是否需要代码分割， 也就是 chunks 配置，如果需要分割会走到 cacheGroups 内看如何分割， 从 defaultVendors 看看是否在 node_modules 里， 那它就符合这个配置的要求， 于是他就会把需要打包的模块（如 lodash）打包在一个 Vendors 组里面去。</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220808175459244.png" alt="image-20220808175459244"></p> <p>这个文件是在 vendors 组内， 入口文件是 main.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>   <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
          <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'vendors.js'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>加上 filename 可以使文件名改为 vendors.js</p> <h4 id="minsize"><a href="#minsize" class="header-anchor">#</a> minSize</h4> <p>minSize: 30000</p> <p>引入的文件大于 30000 字节才进行分割， 一般配置 30000。</p> <p>如果不是 node_modules 内的文件， 需要配置一个默认选项：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
          <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'vendors.js'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'common.js'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
</code></pre></div><p>这样打包后会在文件前加 default~的前缀， 如下：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220808175516416.png" alt="image-20220808175516416"></p> <h4 id="maxsize"><a href="#maxsize" class="header-anchor">#</a> maxSize</h4> <p>基本上没用， 一般不会配置这个选项。</p> <p>这个配置是进行二次拆分的选项。 比如一个 lodash 库， 你配置 50000， 也就是 50kb， 这个 lodash 库是 1m， 那么它会拆分成 20 个文件， 但是一般情况下 lodash 库是拆分不了的。</p> <h4 id="minchunks"><a href="#minchunks" class="header-anchor">#</a> minChunks</h4> <p>当一个模块引入了多少次才会进行代码分割。</p> <h4 id="maxasyncrequests"><a href="#maxasyncrequests" class="header-anchor">#</a> maxAsyncRequests</h4> <p>同时加载的模块数量。一般不会配置。默认即可。</p> <p>比如我们这个选项配置为 5， 加入我引入了 10 个库， 分割了 10 个文件，那你一打开网页的时候， 同时要加载 10 个文件。那就违反了 maxAsyncRequests 配置为 5 的要求， 同时只能加载 5 个请求， 那么 webpack 在打包前 5 个库的时候会为你生成 5 个 js 文件， 超过 5 个它就不会做代码分割了。</p> <h4 id="maxinitialrequests"><a href="#maxinitialrequests" class="header-anchor">#</a> maxInitialRequests</h4> <p>一般不会配置。默认即可。</p> <p>整个网站首页加载的时候， 或者说入口文件加载的时候， 入口文件可能会引入其它的 js 文件。入口文件引入的库如果是配置为 3， 那么最多做 3 次代码分割。 超过 3 个就不会再做代码分割了。</p> <h4 id="automaticnamedelimiter"><a href="#automaticnamedelimiter" class="header-anchor">#</a> automaticNameDelimiter</h4> <p>组和文件名做连接时的连接符</p> <h4 id="name"><a href="#name" class="header-anchor">#</a> name</h4> <p>为<code>true</code>会让<code>cacheGroups</code>起的名字有效。也就是<code>filename</code>。</p> <h4 id="cachegroups"><a href="#cachegroups" class="header-anchor">#</a> cacheGroups</h4> <p><code>cacheGroups</code>也就是缓存组， 与上面的选项息息相关。会把符合条件的代码缓存到一个组内。</p> <p><code>priority</code>指的是优先级。 哪个大优先哪个。</p> <p><code>reuseExistingChunk: true</code></p> <p>假如我有一个 a 模块， 又有一个 b 模块。a 模块内又使用了 b 模块。在打包 a 代码的时候， 由于 a 模块使用了<br>b 模块，所以 b 模块代码也会被打包进去。但是如果配置这个选项，它会去看， 之前 b 模块代码已经被引入过，那么它会去复用之前打包的模块。</p> <h3 id="chunks-是什么"><a href="#chunks-是什么" class="header-anchor">#</a> Chunks 是什么？</h3> <p>webpack 打包过程中生成的每个文件都是一个 chunk</p> <h5 id="意义"><a href="#意义" class="header-anchor">#</a> 意义</h5> <p>代码分割配置</p> <p>minChunks: 2 至少两个打包文件引入这个模块 才单独分割打包</p> <h2 id="lazy-loading-懒加载"><a href="#lazy-loading-懒加载" class="header-anchor">#</a> Lazy Loading 懒加载</h2> <p>以下代码可以实现懒加载， 在点击页面后再加载代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> _ <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName:&quot;lodash&quot; */</span> <span class="token string">&quot;lodash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;Dell&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Lee&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>优点： 页面加载速度更快。</p> <p>懒加载并不是 webpack 的功能， 它是 ESModule 的一个概念， 只不过 webpack 能够识别对它进行代码分割。</p> <h3 id="打包分析"><a href="#打包分析" class="header-anchor">#</a> 打包分析</h3> <p><a href="https://github.com/webpack/analyse" target="_blank" rel="noopener noreferrer">https://github.com/webpack/analyse<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>package.json</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;dev-build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --profile --json &gt; stats.json --config ./build/webpack.dev.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --config ./build/webpack.dev.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config ./build/webpack.prod.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>整个打包过程的描述放在<code>stats.json</code>文件内。</p> <p>打开http://webpack.github.io/analyse/，把文件上传即可得到以下的分析图。</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/bundleanaliy.png" alt="输入图片说明"></p> <p>当然也可以使用 Webpack Bundle Analyzer 这个插件。</p> <h2 id="preloading-prefetching"><a href="#preloading-prefetching" class="header-anchor">#</a> Preloading, Prefetching</h2> <p>webpack 期望首次加载速度最优化，不是利用缓存在下次加载时提高访问速度 应该提高代码使用率</p> <p>show coverage 代码使用率</p> <p>交互代码可以放到单独的异步模块里 提高加载速度及页面利用率</p> <p>如下：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/yubao.png" alt="输入图片说明"></p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/woyaozhibo.png" alt="输入图片说明"></p> <p>但是异步加载交互代码时：例如当点击的时候才再加载异步代码，虽然提高了页面初始化速度，但是对用用户点击<br>的体验不好，速度太慢；</p> <p>为了解决懒加载带来的问题：使用 prefretch preload</p> <p>prefetch:会等主流程都加载完成，等待空闲再加载；（最优）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token string">&quot;LoginModal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>preload：是和主线程一起加载</p> <h2 id="css-代码分割"><a href="#css-代码分割" class="header-anchor">#</a> css 代码分割</h2> <p>想要使用 css 代码分割我们必须要修改一下 Tree Shaking 配置</p> <p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;*.css&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;*.scss&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>首先， 我们需要安装一个插件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev mini<span class="token operator">-</span>css<span class="token operator">-</span>extract<span class="token operator">-</span>plugin
</code></pre></div><p>引入 css 文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">&quot;./style.css&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack.prod.js 配置</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].css&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">&quot;[name].chunk.css&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>压缩 css 代码：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i optimize-css-assets-webpack-plugin -D
</code></pre></div><p>webpack.prod.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].css&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">&quot;[name].chunk.css&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
</code></pre></div><h5 id="高级用法"><a href="#高级用法" class="header-anchor">#</a> 高级用法</h5> <p>多个入口文件引入的 css 文件打包到一起， 需要借助 splitChunks，额外增加一个 style 组，只要发现你的打包文件是 css 文件， 统一打包到一个叫 styles.css 的文件内，<code>enforce</code>为<code>true</code>忽略默认的一些参数（如 minsize 之类）。只要你是一个 css 文件我就做代码的拆分，把代码分割到 style.css 文件内。</p> <p>webpack.prod.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">styles</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;styles&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].css&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>当我们想要每个入口文件打包到不同的 css 文件内的时候，还是利用 cacheGroups， 如下： 如果入口文件是 foo 文件就走 fooStyles 的逻辑，如果是 bar 文件就走 barStyles 的逻辑。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">recursiveIssuer</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span>issuer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">recursiveIssuer</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>issuer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> m<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">foo</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src/foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">bar</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src/bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">fooStyles</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">(</span>m<span class="token punctuation">,</span> c<span class="token punctuation">,</span> entry <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            m<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;CssModule&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">recursiveIssuer</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">===</span> entry<span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">barStyles</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">(</span>m<span class="token punctuation">,</span> c<span class="token punctuation">,</span> entry <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            m<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;CssModule&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">recursiveIssuer</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">===</span> entry<span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].css&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="webpack-与浏览器缓存"><a href="#webpack-与浏览器缓存" class="header-anchor">#</a> Webpack 与浏览器缓存</h2> <p>webpack.common.js</p> <p>关闭性能上的警告</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">performance</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</code></pre></div><p>在我们使用 webpack 的时候，线上代码修改的时候，因为代码的名字没有改变导致浏览器在加载<br>网页的时候，取的是缓存中的代码，导致没有及时的获取最新的代码，这时候就要清除浏览器的缓存， 我们可以利用输出文件配置 contenthash， 这样只有在修改代码了才会改变 hash 值， 就可以做到修改了代码线上浏览器缓存也会更新。</p> <p>webpack.prod.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
 <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].[contenthash].js'</span><span class="token punctuation">,</span>
 <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">'[name].[contenthash].js'</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>老版本如果发现即使没修改代码，打包文件的 hash 值也不一样，请按下图配置：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220808175632040.png" alt="image-20220808175632040"></p> <h2 id="shimming-的作用"><a href="#shimming-的作用" class="header-anchor">#</a> Shimming 的作用</h2> <p>shimming 作用：解决 webpack 打包的兼容性问题.</p> <p>比如你引入一个 jquery.ui 的库， 但是没有引入 jquery， 使用了$写代码。 但是在你的业务是有引入 jquery 的， 这样在业务代码如果运行 jqueryui 初始化会报错的。 所以我们应该使用 shimming。</p> <p>webpack.common.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack.common.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;src/index.html&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">$</span><span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
	  <span class="token literal-property property">_join</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">,</span><span class="token string">'join'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	  <span class="token comment">//_: 'lodash'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>以上代码的意思就是如果我的一个模块中使用了<code>$</code>， 那我就会在模块里自动帮你引入 jquery 这个模块。<br>使用_join 就是 lodash 下的 join 方法</p> <h3 id="模块内-this-指向-window"><a href="#模块内-this-指向-window" class="header-anchor">#</a> 模块内 this 指向 window</h3> <p>每个模块的 this 都是指向自身模块， 不会指向 window。 如果想要指向 window， 可以引入这个插件：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i imports-loader --save-dev
</code></pre></div><p>webpack.common.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;imports-loader?this=&gt;window&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
</code></pre></div><h2 id="环境变量"><a href="#环境变量" class="header-anchor">#</a> 环境变量</h2> <p>我们换一种方式来启动不同环境下的打包方式， 通过一个变量:</p> <p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-demo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.css&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.scss&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev-build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --profile --json &gt; stats.json --config ./build/webpack.common.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --config ./build/webpack.common.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --env.production --config ./build/webpack.common.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LiuJunFeng&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@babel/core&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.8.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/plugin-syntax-dynamic-import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.8.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.8.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/preset-env&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.8.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/preset-react&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.8.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;autoprefixer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^9.7.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;babel-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.6&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;clean-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;css-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.4.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;file-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;html-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;imports-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.8.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mini-css-extract-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.9.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;node-sass&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.13.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;optimize-css-assets-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;postcss-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sass-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;style-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.1.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;url-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.41.5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.10&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-dev-server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.10.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-merge&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.2.2&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@babel/polyfill&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.8.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/runtime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.8.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/runtime-corejs2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.8.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jquery&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.4.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lodash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.15&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;react&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^16.12.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;react-dom&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^16.12.0&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;browserslist&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&gt; 1%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;last 2 versions&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;not ie &lt;= 8&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>webpack.common.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.dev.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.prod.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpg|png|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name]_[hash].[ext]&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&quot;images/&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">204800</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(eot|ttf|woff|woff2|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&quot;fonts/&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&quot;sass-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;imports-loader?this=&gt;window&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;src/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">$</span><span class="token operator">:</span> <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">usedExports</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;vendors&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">performance</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>env <span class="token operator">&amp;&amp;</span> env<span class="token punctuation">.</span>production<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack.dev.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;cheap-module-eval-source-map&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hotOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&quot;sass-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> devConfig<span class="token punctuation">;</span>
</code></pre></div><p>webpack.prod.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;cheap-module-eval-source-map&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hotOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&quot;sass-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> devConfig<span class="token punctuation">;</span>
</code></pre></div><p>我们也可以在 package.json 里这样写：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/packge.json.png" alt="输入图片说明"></p> <p>那么对应的 webpack.common.js 是这样的</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/commonjs.png" alt="输入图片说明"></p> <p>还可以这么写：</p> <p>package.json</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/jdakdj.png" alt="输入图片说明"></p> <p>webpack.common.js</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/zhendeleia.png" alt="输入图片说明"></p> <h2 id="打包组件库-2"><a href="#打包组件库-2" class="header-anchor">#</a> 打包组件库</h2> <p>创建一个新的文件夹 Library,   并初始化项目：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> init -y
</code></pre></div><p>安装 webpack</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i webpack webpack-cli --save
</code></pre></div><p>创建 webpack.config.js 配置以下代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;library.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span> <span class="token comment">//无论什么方式引入组件都可以正确引入到</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Library&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LIU&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.41.5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.10&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果你想这样通过 src 引入 js， 并且想通过 library 获取它下面的方法或属性，</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/srcjs.png" alt="输入图片说明"></p> <p>添加<code>library: 'library'</code>即可</p> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;library.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&quot;library&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span> <span class="token comment">//无论什么方式引入组件都可以正确引入到</span>
    <span class="token comment">//libraryTarget: 'this',</span>
    <span class="token comment">//libraryTarget: 'window',</span>
    <span class="token comment">//libraryTarget: 'global',</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这样配置好以下几种方式都可以正确引入了：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/houqiyingx.png" alt="输入图片说明"></p> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lodash&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//打包过程中如果遇到lodash库你就忽略这个库，不要把它打包到你的代码中去，防止使用时用户重复引入库（例如：lodash）</span>
  <span class="token comment">// externals: {</span>
  <span class="token comment">//     lodash: {</span>
  <span class="token comment">//         //root: '_',//全局script标签引入，必须在页面注入一个名字叫_的变量</span>
  <span class="token comment">//         //commonjs: 'lodash'//如果我的lodash在commonjs这个环境中使用，并且引入名字必须是lodash</span>
  <span class="token comment">//     }</span>
  <span class="token comment">// },</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;library.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&quot;library&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span> <span class="token comment">//无论什么方式引入组件都可以正确引入到</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/3nianasannian.png" alt="输入图片说明"></p> <p>package.json</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Library&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/library.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LIU&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;lodash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.15&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.41.5&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.10&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>发布组件库流程：</p> <ul><li>登录 npm</li> <li>命令行<code>npm adduser</code>,输入用户名，密码</li> <li>命令行 <code>npm publish</code>   发布到 npm</li></ul> <h2 id="pwa-的打包配置"><a href="#pwa-的打包配置" class="header-anchor">#</a> PWA 的打包配置</h2> <h3 id="安装插件模拟服务器"><a href="#安装插件模拟服务器" class="header-anchor">#</a> 安装插件模拟服务器</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code> npm i http<span class="token operator">-</span>server <span class="token operator">--</span>save<span class="token operator">-</span>dev
</code></pre></div><p>package.json</p> <p>scripts 命令</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http-server dist&quot;</span><span class="token punctuation">,</span>
</code></pre></div><p>PWA：是一种强缓存技术，访问过的页面就算服务器断开，也能通过缓存浏览之前访问的页面</p> <p>只在上线环境配置就可以了， 开发环境不用考虑服务器挂掉不挂掉的问题。</p> <h4 id="安装插件-8"><a href="#安装插件-8" class="header-anchor">#</a> 安装插件</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i workbox-webpack-plugin --save-dev
</code></pre></div><h4 id="配置-10"><a href="#配置-10" class="header-anchor">#</a> 配置</h4> <p>webpack.prod.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> WorkboxPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;workbox-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].css&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">&quot;[name].chunk.css&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">WorkboxPlugin<span class="token punctuation">.</span>GenerateSW</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">clientsClaim</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">skipWaiting</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>业务逻辑文件增加以下代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;serviceWorker&quot;</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>serviceWorker
      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;/service-worker.js&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">registration</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;service-worker registed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;service-worker register error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="typescript-的打包配置"><a href="#typescript-的打包配置" class="header-anchor">#</a> TypeScript 的打包配置</h2> <p>安装插件：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i ts-loader typescript --save
</code></pre></div><p>webpack-config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">rule</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.tsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">'ts-loader'</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>创建 tsconfig.json 文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;outDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">,</span><span class="token comment">//输出目录</span>
        <span class="token string-property property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es6&quot;</span><span class="token punctuation">,</span><span class="token comment">//只允许es6 Module的方式引入模块</span>
        <span class="token string-property property">&quot;target&quot;</span><span class="token operator">:</span><span class="token string">&quot;es5&quot;</span><span class="token punctuation">,</span><span class="token comment">//编译为Es5这样的代码</span>
        <span class="token string-property property">&quot;allowJs&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token comment">//允许TS里引入js这样的模块</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果想引入 lodash 库，并且想让它的非法错误提示出来， 首先安装一个这样的模块：</p> <div class="language-shell extra-class"><pre class="language-shell"><code> <span class="token function">npm</span> i @types/lodash --save-dev
</code></pre></div><p>如下图， 如果不向<code>join</code>方法传入参数会有报错提示</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/jqueryjs.png" alt="输入图片说明"></p> <p>如果还想安装 jquery 库， 那你也需要安装对应的类型文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i @types/jquery --save-dev
</code></pre></div><p>这个网站可以查询都有哪些类型文件可以试用：</p> <p><a href="https://microsoft.github.io/TypeSearch/" target="_blank" rel="noopener noreferrer">https://microsoft.github.io/TypeSearch/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="webpackdevserver-2"><a href="#webpackdevserver-2" class="header-anchor">#</a> WebpackDevServer</h2> <h3 id="请求转发"><a href="#请求转发" class="header-anchor">#</a> 请求转发</h3> <p>如果我们现在项目内发送请求， 我们一般会安装一个 axios 库</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i axios --save
</code></pre></div><p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/meibanfaces.png" alt="输入图片说明"></p> <p>在项目中我们一般会在开发环境有一个请求 api 以供测试， 线上环境有一个请求 api。 这时候我们一般需要使用相对路径写接口地址， 但是使用相对路径接口地址带上的就是 localhost 了， 这时候我们需要做一个代理：</p> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	<span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
		<span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">hotOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token string-property property">'/react/api'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'https://www.dell-lee.com'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token literal-property property">pathRewrite</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token string-property property">'header.json'</span><span class="token operator">:</span> <span class="token string">'demo.json'</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
				<span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'www.dell-lee.com'</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>secure: false： https 的接口需要设置这个</p> <p>pathRewrite: 相当于想要去获取 header.json， 配置这个获取的是 demo.json。 一般用于后端接口还没写好的时候使用一个 demo 数据， 等写好了再使用写好的接口，只需要把这个选项注释掉， 不用去业务代码中再修改了。</p> <p>changeOrigin: true 始终配置就行， 主要为了有的网站使用了 origin 限制。</p> <p>headers： 设置请求头， 可设置 host, cookie</p> <h3 id="解决单页面应用路由问题"><a href="#解决单页面应用路由问题" class="header-anchor">#</a> 解决单页面应用路由问题</h3> <p>首先我们需要安装一个路由插件：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i react-router-dom --save
</code></pre></div><p>在我们使用单页应用时， 如果我们要访问 list 页面， 那么服务器会以为我们访问的是一个叫 list 的页面。但是我们的文件里并没有一个 list.html， 那它就会提示我们页面不存在。</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/yuchengjinro.png" alt="输入图片说明"></p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/langduibuxing.png" alt="输入图片说明"></p> <p>想要达到我们预期的效果， 需要配置 devServer</p> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	<span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
		<span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">hotOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">historyApiFallback</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
</code></pre></div><p>当然你也可以单独设置每个地址的访问，如 abc.html<br>转发到 index.html</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>		<span class="token literal-property property">historyApiFallback</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">rewrites</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
				<span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">abc.html</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
				<span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">'/index.html'</span>
			<span class="token punctuation">}</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>historyApiFallback只在开发环境中有效，线上环境需要和后端配合
</code></pre></div><h2 id="eslint"><a href="#eslint" class="header-anchor">#</a> EsLint</h2> <h3 id="使用-eslint-检测代码"><a href="#使用-eslint-检测代码" class="header-anchor">#</a> 使用 eslint 检测代码</h3> <p>安装插件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i eslint --save-dev
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>npx eslint --init
</code></pre></div><p>配置好文件以后可以用此命令查看项目文件是否符合语法：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>npx eslint src
</code></pre></div><p>安装解析器</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i babel-eslint --save-dev
</code></pre></div><p>.eslintrc.js</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/buwena.png" alt="输入图片说明"></p> <h3 id="vscode-中的-eslint"><a href="#vscode-中的-eslint" class="header-anchor">#</a> vscode 中的 ESlint</h3> <p>其实我们也可以不借助 webpack， 直接使用编辑器自带的插件， 如 vscode 的 Eslint 插件， 这样使用会更加方便！</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/zaichongyiba.png" alt="输入图片说明"></p> <p>如果我们的团队有些规范并不想要符合 airbnb 它的规范， 我们可以这么配置：<br>首先复制出规范的名称， 如下图：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/qiangnuzhimo.png" alt="输入图片说明"></p> <p>然后再.eslintrc.js 文件的 rules 里进行配置：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/eslintrc.png" alt="输入图片说明"></p> <p>假设我们团队有一个同学使用的不是 vscode， 他没有这样的语法提示， 就会跟我们写的代码不一样。 这时候我们就需要借助 webpack 了：</p> <p>首先我们需要安装一个这样的插件：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i eslint-loader --save-dev
</code></pre></div><p>然后再 webpack.config.js 配置</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/config.jswebpack.png" alt="输入图片说明"></p> <div class="language- extra-class"><pre class="language-text"><code>eslint-loader  一定要写在后面， 只有语法正确再进行转义或者其它。因为loader是先执行后边再执行前边的。
</code></pre></div><h5 id="eslint-安装使用流程"><a href="#eslint-安装使用流程" class="header-anchor">#</a> Eslint 安装使用流程</h5> <ul><li>安装 Eslint</li> <li>安装 Eslint-loader</li> <li>webpack 内 devServer 配置 overlay</li> <li>webpack 内 js 文件配置 eslint-loader</li></ul> <h4 id="eslint-其他配置"><a href="#eslint-其他配置" class="header-anchor">#</a> Eslint 其他配置</h4> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">fix</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">force</span><span class="token operator">:</span> <span class="token string">'pre'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>fix: true   自动帮你修复比较浅显的问题</p> <p>force: 'pre'   强制先执行 eslint-loader</p> <h3 id="最佳实践-2"><a href="#最佳实践-2" class="header-anchor">#</a> 最佳实践</h3> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/gitgouzi.png" alt="输入图片说明"></p> <p>不用配置 webpack， 直接使用 git 的钩子， 再提交代码时验证语法。</p> <h2 id="webpack-性能优化"><a href="#webpack-性能优化" class="header-anchor">#</a> webpack 性能优化</h2> <h4 id="_1-跟上技术的迭代-node-npm-yarn"><a href="#_1-跟上技术的迭代-node-npm-yarn" class="header-anchor">#</a> 1. 跟上技术的迭代（Node， Npm， Yarn）</h4> <h4 id="_2-在尽可能少的模块上应用-loader"><a href="#_2-在尽可能少的模块上应用-loader" class="header-anchor">#</a> 2. 在尽可能少的模块上应用 Loader</h4> <p>可以干掉的配置：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/woshishui8.png" alt="输入图片说明"></p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/gandiaopeizhi.png" alt="输入图片说明"></p> <h4 id="_3-plugin-尽可能精简并确保可靠"><a href="#_3-plugin-尽可能精简并确保可靠" class="header-anchor">#</a> 3. Plugin 尽可能精简并确保可靠</h4> <h4 id="_4-resolve-参数合理配置"><a href="#_4-resolve-参数合理配置" class="header-anchor">#</a> 4. resolve 参数合理配置</h4> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/resolvecanshu.png" alt="输入图片说明"></p> <p>extensions 建议配逻辑文件， css，图片类不要配置， 浪费性能。</p> <h4 id="_5-使用-dllplugin-提高打包速度"><a href="#_5-使用-dllplugin-提高打包速度" class="header-anchor">#</a> 5. 使用 DllPlugin 提高打包速度</h4> <p>我们引入了一个 lodash 库， 我们知道这个库的文件它是不会变的， 但是每次打包都会打包它， 我们可以让它只在第一次打包， 下次就不打包了。</p> <p>首先创建一个 webpack.dll.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lodash&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">react</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].dll.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&quot;[name]&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name]&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dll/[name].manifest.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>运行命令打包组件库：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/dabaozuyjianku.png" alt="输入图片说明"></p> <p>然后安装一个插件：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i  add-asset-html-webpack-plugin --save
</code></pre></div><p>在 webpack.common.js 引入</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//引入核心模块</span>
<span class="token keyword">const</span> AddAssetHtmlPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;add-asset-html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;src/index.html&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;dist&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">root</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.*\.dll.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filepath</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dll&quot;</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.*\.manifest.json</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">manifest</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dll&quot;</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-控制包大小"><a href="#_6-控制包大小" class="header-anchor">#</a> 6. 控制包大小</h4> <p>不要引入无用组件库， 多使用 Tree Shaking，   使用 SplitChunks 代码拆分。</p> <h4 id="_7-thread-loader-parallel-webpack-happypack-多进程打包"><a href="#_7-thread-loader-parallel-webpack-happypack-多进程打包" class="header-anchor">#</a> 7. thread-loader, parallel-webpack, happypack 多进程打包</h4> <h4 id="_8-合理使用-sourcemap"><a href="#_8-合理使用-sourcemap" class="header-anchor">#</a> 8. 合理使用 SourceMap</h4> <p>不要太详细，配置合适的即可</p> <h4 id="_9-结合-stats-分析打包结果"><a href="#_9-结合-stats-分析打包结果" class="header-anchor">#</a> 9. 结合 Stats 分析打包结果</h4> <h4 id="_10-开发环境内存编译-无用插件剔除"><a href="#_10-开发环境内存编译-无用插件剔除" class="header-anchor">#</a> 10. 开发环境内存编译， 无用插件剔除</h4> <p>开发环境配置模式为<code>development</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="多页面打包配置"><a href="#多页面打包配置" class="header-anchor">#</a> 多页面打包配置</h2> <p>配置 entry：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/entrywebpack.png" alt="输入图片说明"></p> <p>想要添加多页面首先在 src 目录增加对应的 js 文件，然后在 entry 增加入口文件</p> <p>webpack.common.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> AddAssetHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;add-asset-html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">makePlugins</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">configs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>configs<span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;src/index.html&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;runtime&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vendors&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.*\.dll.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">filepath</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dll&quot;</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.*\.manifest.json</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">manifest</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dll&quot;</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> plugins<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> configs <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token string">&quot;./src/list.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.jsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpg|png|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name]_[hash].[ext]&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&quot;images/&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(eot|ttf|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">runtimeChunk</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;runtime&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedExports</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;vendors&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">performance</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

configs<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token function">makePlugins</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> configs<span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="如何编写一个-loader"><a href="#如何编写一个-loader" class="header-anchor">#</a> 如何编写一个 loader</h2> <p>首先创建一个文件夹 make-loader, 对项目初始化, 然后安装 webpack</p> <div class="language- extra-class"><pre class="language-text"><code>npm init -y
npm i webpack webpack-cli --save-dev
</code></pre></div><p>创建文件夹 loader， loader 文件夹内创建文件 replaceLoader.js</p> <p>我们要实现的目标是如果发现我们的业务逻辑文件内有<code>dell</code>这个字符， 我们要把它修改成<code>dellLee</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//replaceLoader.js</span>
<span class="token comment">//source 引入文件的内容</span>
<span class="token comment">//this.query携带传过来的参数,name是loader配置的name参数</span>
<span class="token comment">//loaderUtils可以分析参数， 比如参数是个对象的时候可以用到</span>
<span class="token comment">//this.callback代替return 传递除result,还可以传递sourcemap等内容</span>
<span class="token comment">//异步loader 使用this.async()</span>
<span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;loader-utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;dell&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//replaceLoader.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;dell&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//当你引入loader的时候，会先在node_modules里找，如果没有回去loader里去找</span>
  <span class="token literal-property property">resolveLoader</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./loaders&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;replaceLoader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;replaceLoaderAsync&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;lee&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>如果你的 loader 配置参数有些诡异， 如是一个对象， 这时候我们可以使用一个插件做分析：</p> <div class="language- extra-class"><pre class="language-text"><code>npm i loader-utils --save-dev
</code></pre></div><h2 id="如何编写一个-plugin"><a href="#如何编写一个-plugin" class="header-anchor">#</a> 如何编写一个 Plugin</h2> <h4 id="plugin-与-loader-的区别"><a href="#plugin-与-loader-的区别" class="header-anchor">#</a> Plugin 与 loader 的区别</h4> <h5 id="loader-2"><a href="#loader-2" class="header-anchor">#</a> loader</h5> <p>当我们在源代码中引入一个新的 js 文件，或者一个其他格式的文件的时候， 我们可以使用 loader 处理这个引入的文件。</p> <h5 id="plugin"><a href="#plugin" class="header-anchor">#</a> Plugin</h5> <p>在我们做打包的时候， 在某一个具体时刻上。 比如说， 当我打包结束后，我要自动生成一个 html 文件， 这时候我们就可以使用一个 html-webpack-plugin 的插件。它会在打包结束后生成 html 文件。</p> <p>Plugin 可以在我们打包过程的某个时刻想做一些事情。</p> <p>首先我们初始化一个项目， 安装 webpack 和 webpack-cli。</p> <p>如果我们想要生成带版权的文件， 可以这么做：</p> <p>创建文件夹 plugins， plugins 文件夹内创建 copyright-webpack-plugin.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//options是plugin配置传过来的参数</span>
<span class="token comment">//compiler是webpack的实例，存储了我们webpack相关各种各样的配置文件，打包过程，等等一系列的内容。</span>
<span class="token comment">//钩子， 指某个时刻会自动执行的函数。 如vue生命周期</span>
<span class="token comment">//emit  当你把打包资源放到目标文件夹的时刻。它是一个异步的钩子。 可以在后面写一个tabAsync. 他有两个参数 第一个是插件名字，第二个是剪头函数</span>
<span class="token comment">//compile  同步的钩子， 后面跟tap， 箭头函数只传compilation</span>
<span class="token comment">//compilation 和compiler不一样， 只存放这次打包的相关内容</span>
<span class="token comment">//compilation.assets 打包生成的内容</span>
<span class="token keyword">class</span> <span class="token class-name">CopyrightWebpackPlugin</span> <span class="token punctuation">{</span>
  <span class="token comment">// constructor(options) {</span>
  <span class="token comment">// }</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compile<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;CopyrightWebpackPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;compiler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span>
      <span class="token string">&quot;CopyrightWebpackPlugin&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span><span class="token string">&quot;copyright.txt&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token function-variable function">source</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;copyright by dell lee&quot;</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">size</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">21</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> CopyrightWebpackPlugin<span class="token punctuation">;</span>
</code></pre></div><p>在 webpack.config.js 配置：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CopyRightWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./plugins/copyright-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CopyRightWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="node-调试工具"><a href="#node-调试工具" class="header-anchor">#</a> node 调试工具</h4> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/nodetiaoshigongju.png" alt="输入图片说明"></p> <p>--inspect 开启 node 调试工具</p> <p>--inspect-brk webpack 执行命令的第一行打断点</p> <p>输入 npm run debug 后打开浏览器， 点击控制台左上角 node 小图标</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/nodetiaoshi.png" alt="输入图片说明"></p> <p>这时候我们就可以看到插件的详细信息了</p> <p>可在 watch 增加 compilation 的监控</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/compations.png" alt="输入图片说明"></p> <h2 id="bundler-源码编写"><a href="#bundler-源码编写" class="header-anchor">#</a> Bundler 源码编写</h2> <h3 id="模块分析"><a href="#模块分析" class="header-anchor">#</a> 模块分析</h3> <h2 id="vue-cli-3-的配置方法"><a href="#vue-cli-3-的配置方法" class="header-anchor">#</a> Vue CLI 3 的配置方法</h2> <p>Vue 内的 Webpack 设计理念是让我们用的更爽， 即使是 webpack 小白用户我们也能够轻松使用。</p> <p>如果我们想配置 webpack， 需要在项目的根目录创建一个 vue.config.js</p> <p>这里的配置和 webpack 并不一样， 它对 webpack 的配置进行了大量的封装， 如果我们需要配置， 可参考脚手架的配置参考：<a href="https://cli.vuejs.org/zh/config/" target="_blank" rel="noopener noreferrer">https://cli.vuejs.org/zh/config/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>如果我们想实现原生的 webpack， 在脚手架参考文档使用 configureWebpack即可。</p> <h2 id="实现小型打包工具"><a href="#实现小型打包工具" class="header-anchor">#</a> 实现小型打包工具</h2> <p>该工具可以实现以下两个功能</p> <ul><li>将 ES6 转换为 ES5</li> <li>支持在 JS 文件中 import CSS 文件</li></ul> <p>通过这个工具的实现，大家可以理解到打包工具的原理到底是什么。</p> <h4 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h4> <p>因为涉及到 ES6 转 ES5，所以我们首先需要安装一些 Babel 相关的工具</p> <p><code>yarn add babylon babel-traverse babel-core babel-preset-env</code></p> <p>接下来我们将这些工具引入文件中</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> babylon <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;babylon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;babel-traverse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> transformFromAst <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;babel-core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>首先，我们先来实现如何使用 Babel 转换代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">readCode</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 读取文件内容</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 生成 AST</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> babylon<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 寻找当前文件的依赖关系</span>
  <span class="token keyword">const</span> dependencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">ImportDeclaration</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> node <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      dependencies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 通过 AST 将代码转为 ES5</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">transformFromAst</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    filePath<span class="token punctuation">,</span>
    dependencies<span class="token punctuation">,</span>
    code<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>首先我们传入一个文件路径参数，然后通过 <code>fs</code> 将文件中的内容读取出来</li> <li>接下来我们通过 <code>babylon</code> 解析代码获取 AST，目的是为了分析代码中是否还引入了别的文件</li> <li>通过 <code>dependencies</code> 来存储文件中的依赖，然后再将 AST 转换为 ES5 代码</li> <li>最后函数返回了一个对象，对象中包含了当前文件路径、当前文件依赖和当前文件转换后的代码</li></ul> <p>接下来我们需要实现一个函数，这个函数的功能有以下几点</p> <ul><li>调用 <code>readCode</code> 函数，传入入口文件</li> <li>分析入口文件的依赖</li> <li>识别 JS 和 CSS 文件</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getDependencies</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 读取入口文件</span>
  <span class="token keyword">const</span> entryObject <span class="token operator">=</span> <span class="token function">readCode</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> dependencies <span class="token operator">=</span> <span class="token punctuation">[</span>entryObject<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 遍历所有文件依赖关系</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> asset <span class="token keyword">of</span> dependencies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获得文件目录</span>
    <span class="token keyword">const</span> dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>asset<span class="token punctuation">.</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 遍历当前文件依赖关系</span>
    asset<span class="token punctuation">.</span>dependencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">relativePath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获得绝对路径</span>
      <span class="token keyword">const</span> absolutePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dirname<span class="token punctuation">,</span> relativePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// CSS 文件逻辑就是将代码插入到 `style` 标签中</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>absolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>absolutePath<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
          const style = document.createElement('style')
          style.innerText = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\r\\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
          document.head.appendChild(style)
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        dependencies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">filePath</span><span class="token operator">:</span> absolutePath<span class="token punctuation">,</span>
          relativePath<span class="token punctuation">,</span>
          <span class="token literal-property property">dependencies</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          code<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// JS 代码需要继续查找是否有依赖关系</span>
        <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">readCode</span><span class="token punctuation">(</span>absolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        child<span class="token punctuation">.</span>relativePath <span class="token operator">=</span> relativePath<span class="token punctuation">;</span>
        dependencies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> dependencies<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>首先我们读取入口文件，然后创建一个数组，该数组的目的是存储代码中涉及到的所有文件</li> <li>接下来我们遍历这个数组，一开始这个数组中只有入口文件，在遍历的过程中，如果入口文件有依赖其他的文件，那么就会被 push 到这个数组中</li> <li>在遍历的过程中，我们先获得该文件对应的目录，然后遍历当前文件的依赖关系</li> <li>在遍历当前文件依赖关系的过程中，首先生成依赖文件的绝对路径，然后判断当前文件是 CSS 文件还是 JS 文件
<ul><li>如果是 CSS 文件的话，我们就不能用 Babel 去编译了，只需要读取 CSS 文件中的代码，然后创建一个 style 标签，将代码插入进标签并且放入 head 中即可</li> <li>如果是 JS 文件的话，我们还需要分析 JS 文件是否还有别的依赖关系最后将读取文件后的对象 <code>push</code> 进数组中</li></ul></li></ul> <p>现在我们已经获取到了所有的依赖文件，接下来就是实现打包的功能了</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">bundle</span><span class="token punctuation">(</span><span class="token parameter">dependencies<span class="token punctuation">,</span> entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> modules <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 构建函数参数，生成的结构为</span>
  <span class="token comment">// { './entry.js': function(module, exports, require) { 代码 } }</span>
  dependencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dep</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> filePath <span class="token operator">=</span> dep<span class="token punctuation">.</span>relativePath <span class="token operator">||</span> entry<span class="token punctuation">;</span>
    modules <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">': (
      function (module, exports, require) { </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dep<span class="token punctuation">.</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> }
    ),</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 构建 require 函数，目的是为了获取模块暴露出来的内容</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    (function(modules) {
      function require(id) {
        const module = { exports : {} }
        modules[id](module, module.exports, require)
        return module.exports
      }
      require('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entry<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')
    })({</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>modules<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">})
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token comment">// 当生成的内容写入到文件中</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;./bundle.js&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这段代码需要结合着 Babel 转换后的代码来看，这样大家就能理解为什么需要这样写了</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// entry.js</span>
<span class="token keyword">var</span> _a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> _a2 <span class="token operator">=</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span>_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> obj <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>__esModule <span class="token operator">?</span> obj <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> obj <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_a2<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// a.js</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>default <span class="token operator">=</span> a<span class="token punctuation">;</span>
</code></pre></div><p>Babel 将我们 ES6 的模块化代码转换为了 CommonJS 的代码，但是浏览器是不支持 CommonJS 的，所以如果这段代码需要在浏览器环境下运行的话，我们需要自己实现 CommonJS 相关的代码，这就是 <code>bundle</code> 函数做的大部分事情。</p> <p>接下来我们再来逐行解析 <code>bundle</code> 函数</p> <ul><li>首先遍历所有依赖文件，构建出一个函数参数对象</li> <li>对象的属性就是当前文件的相对路径，属性值是一个函数，函数体是当前文件下的代码，函数接受三个参数 <code>module</code>、<code>exports</code>、 <code>require</code> <ul><li><code>module</code> 参数对应 CommonJS 中的 <code>module</code></li> <li><code>exports</code> 参数对应 CommonJS 中的 <code>module.export</code></li> <li><code>require</code> 参数对应我们自己创建的 <code>require</code> 函数</li></ul></li> <li>接下来就是构造一个使用参数的函数了，函数做的事情很简单，就是内部创建一个 <code>require</code> 函数，然后调用 <code>require(entry)</code>，也就是 <code>require('./entry.js')</code>，这样就会从函数参数中找到 <code>./entry.js</code>对应的函数并执行，最后将导出的内容通过 module.export 的方式让外部获取到</li> <li>最后再将打包出来的内容写入到单独的文件中</li></ul> <p>如果你对于上面的实现还有疑惑的话，可以阅读下打包后的部分简化代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 构造一个 CommonJS 导出代码</span>
    <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 去参数中获取文件对应的函数并执行</span>
    modules<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> require<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./entry.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;./entry.js&quot;</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里继续通过构造的 require 去找到 a.js 文件对应的函数</span>
    <span class="token keyword">var</span> _a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_a2<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;./a.js&quot;</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// 将 require 函数中的变量 module 变成了这样的结构</span>
    <span class="token comment">// module.exports = 1</span>
    <span class="token comment">// 这样就能在外部取到导出的内容了</span>
    exports<span class="token punctuation">.</span>default <span class="token operator">=</span> a<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 省略</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>小结:</strong></p> <p>虽然实现这个工具只写了不到 100 行的代码，但是打包工具的核心原理就是这些了</p> <ol><li>找出入口文件所有的依赖关系</li> <li>然后通过构建 CommonJS 代码来获取 <code>exports</code> 导出的内容</li></ol> <h2 id="如何配置别名"><a href="#如何配置别名" class="header-anchor">#</a> 如何配置别名</h2> <p>vue.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token function">chainWebpack</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'components'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/components'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'common'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/common'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'api'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/api'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'base'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/base'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="常见面试题总结"><a href="#常见面试题总结" class="header-anchor">#</a> 常见面试题总结</h2> <h3 id="module-chunk-bundle-分别什么意思-有何区别"><a href="#module-chunk-bundle-分别什么意思-有何区别" class="header-anchor">#</a> module chunk bundle 分别什么意思，有何区别?</h3> <ul><li>module： 各个源码文件， webpack 中一切皆模块</li> <li>chunk： 多模块合并成的， 如 entry import() splitChunk</li> <li>bundle： 最终输出的文件</li> <li><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/bundle.png" alt="输入图片说明"></li></ul> <h3 id="webpack-常见性能优化-综合"><a href="#webpack-常见性能优化-综合" class="header-anchor">#</a> webpack 常见性能优化 - 综合</h3> <ol><li>Node， Npm/Yarn 更新到最新版本</li> <li>Plugin 尽可能精简可靠</li> <li>resolve 参数合理配置</li> <li><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/resolve.png" alt="输入图片说明"><br>extensions 建议配逻辑文件， css，图片类不要配置， 浪费性能。</li> <li>合理使用 SourceMap 不要太详细，配置合适的即可</li></ol> <h3 id="webpack-常见性能优化-构建速度"><a href="#webpack-常见性能优化-构建速度" class="header-anchor">#</a> webpack 常见性能优化 - 构建速度</h3> <ol><li>优化 babel-loader</li></ol> <div class="language-json extra-class"><pre class="language-json"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// js 文件才使用 babel</span>
    test<span class="token operator">:</span> /\.js$/<span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>'babel-loader?cacheDirectory'<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//开启缓存</span>
    include<span class="token operator">:</span> <span class="token punctuation">[</span>resolve('src')<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//明确范围 只在 src 文件夹下查找</span>
    exclude<span class="token operator">:</span> /node_modules/<span class="token punctuation">,</span><span class="token comment">// 不会去查找的路径</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>;
</code></pre></div><p>对于 Babel 来说，我们肯定是希望只作用在 JS 代码上的，然后 <code>node_modules</code> 中使用的代码都是编译过的，所以我们也完全没有必要再去处理一遍。</p> <p>使用<code>use: ['babel-loader?cacheDirectory']</code>开启缓存， 只要 ES6 代码没有改的就不会再重新编译，而是缓存下来。</p> <p>在第二次进行编译的时候，针对没有改的部分启用缓存， 不用再重新编译。</p> <p><code>include</code>、<code>exclude</code> 明确具体范围。比如 <code>node_modules</code>内文件就不要使用 <code>babel-loader</code> 了</p> <ol start="2"><li>IgnorePlugin(忽略无用文件)</li></ol> <blockquote><p>有以下这种场景， 我们需要使用一个 moment 日历插件， 它支持很多种语言。 在默认情况下它是所有语言都引入的， 而我们实际开发中只需要中文。 这样就会导致打包了很多不必要的代码。 有没有什么方法可以做到只打包中文语言呢？</p></blockquote> <p>index.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">&quot;moment&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;moment/locale/zh-cn&quot;</span><span class="token punctuation">;</span> <span class="token comment">//手动引入中文语言包</span>
moment<span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">&quot;zh-cn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置语言为中文</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;locale&quot;</span><span class="token punctuation">,</span> moment<span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;ll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2020年xx月xx日</span>
</code></pre></div><p>首先引入 moment 库， 并引入中文语言包</p> <p>webpack.prod.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 忽略 moment 下的 /locale 目录</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.\/locale</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>在开发环境下配置 plugins ， 不会打包 moment 下的 locale 文件。</p> <p>IgnorePlugin 是直接不引入， 代码中没有</p> <ol start="3"><li>noParse</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//完整的 react.min.js 文件就没有采用模块化</span>
    <span class="token comment">//忽略对 react.min.js 文件的递归解析处理</span>
    <span class="token literal-property property">noParse</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">react\.min\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>如果你确定一个文件下没有其他依赖，就可以使用该属性让 Webpack 不扫描该文件，这种方式对于大型的类库很有帮助</p> <p>一般情况下我们使用的 react.min.js 都是打包后的文件， 我们没有必要再次进行打包， 对于这种文件我们可以进行忽略。</p> <p>noParse 是引入， 但不进行打包。</p> <ol start="4"><li>happyPack （多进程打包）</li></ol> <ul><li>JS 单线程，开启多进程打包</li> <li>提高构建速度（特别是多核 CPU）</li></ul> <p>受限于 Node 是单线程运行的，所以 Webpack 在打包的过程中也是单线程的，特别是在执行 Loader 的时候，长时间编译的任务很多，这样就会导致等待的情况。</p> <p><strong>HappyPack 可以将 Loader 的同步执行转换为并行的</strong>，这样就能充分利用系统资源来加快打包效率了</p> <p>webpack.prod.js</p> <p>首先引入 happypack</p> <p>webpack.prod.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;happypack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">smart</span><span class="token punctuation">(</span>webpackCommonConf<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// js</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 把对 .js 文件的处理转交给 id 为 babel 的 HappyPack 实例</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;happypack/loader?id=babel&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span> srcPath<span class="token punctuation">,</span>
        <span class="token comment">// exclude: /node_modules/</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// happyPack 开启多进程打包</span>
    <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 用唯一的标识符 id 来代表当前的 HappyPack 是用来处理一类特定的文件</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;babel&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// 如何处理 .js 文件，用法和 Loader 配置中一样</span>
      <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;babel-loader?cacheDirectory&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 开启 4 个线程</span>
      <span class="token literal-property property">threads</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">//其他配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="5"><li>ParallelUglifyPlugin （多进程压缩 JS）
<ul><li>webpack 内置 Uglify 工具压缩 JS</li> <li>JS 单线程， 开启多进程压缩更快</li></ul></li></ol> <p>在 Webpack3 中，我们一般使用 UglifyJS 来压缩代码，但是这个是单线程运行的，为了加快效率，我们可以使用 webpack-parallel-uglify-plugin 来并行运行 UglifyJS，从而提高效率。</p> <p>在 Webpack4 中，我们就不需要以上这些操作了，只需要将 mode 设置为 production 就可以默认开启以上功能。代码压缩也是我们必做的性能优化方案，当然我们不止可以压缩 JS 代码，还可以压缩 HTML、CSS 代码，并且在压缩 JS 代码的过程中，我们还可以通过配置实现比如删除 console.log 这类代码的功能。</p> <p>webpack.prod.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> ParallelUglifyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-parallel-uglify-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 使用 ParallelUglifyPlugin 并行压缩输出的 JS 代码</span>
    <span class="token keyword">new</span> <span class="token class-name">ParallelUglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 传递给 UglifyJS 的参数</span>
      <span class="token comment">// （还是使用 UglifyJS 压缩，只不过帮助开启了多进程）</span>
      <span class="token literal-property property">uglifyJS</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">beautify</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 最紧凑的输出</span>
          <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 删除所有的注释</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 删除所有的 `console` 语句，可以兼容ie浏览器</span>
          <span class="token literal-property property">drop_console</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token comment">// 内嵌定义了但是只用到一次的变量</span>
          <span class="token literal-property property">collapse_vars</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token comment">// 提取出出现多次但是没有定义成变量去引用的静态值</span>
          <span class="token literal-property property">reduce_vars</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p><strong>关于开启多进程</strong></p> <ul><li>项目较大， 打包较慢， 开启多进程能提高速度</li> <li>项目较小， 打包很快， 开启多进程会降低速度（进程开销/启动/销毁/通讯）</li></ul> <ol start="6"><li>自动刷新<br><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/zidongshuaxin.png" alt="输入图片说明"></li></ol> <p>一般不用配置， 直接使用 devServer 就可以了。</p> <ol start="7"><li><p>热更新</p> <p>自动刷新： 整个网页会全部刷新， 速度较慢。状态也会丢失。</p></li></ol> <p>热更新： 新代码生效，网页不刷新， 状态不丢失。</p> <p>具体设置参考 <a href="http://l544402029.gitee.io/blog/%E5%89%8D%E7%AB%AF%E5%B7%A5%E5%85%B7/webpack/#HMR" target="_blank" rel="noopener noreferrer">HMR<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这一节。</p> <ol start="8"><li>DllPlugin</li></ol> <p>DllPlugin 可以将特定的类库提前打包然后引入。这种方式可以极大的减少打包类库的次数，只有当类库更新版本才有需要重新打包，并且也实现了将公共代码抽离成单独文件的优化方案。</p> <p>举例：我们引入了一个 lodash 库， 我们知道这个库的文件它是不会变的， 但是每次打包都会打包它， 我们可以让它只在第一次打包， 下次就不打包了。</p> <ul><li>webpack 内置 DllPlugin 支持</li> <li>DllPlugin 打包出 dll 文件</li> <li>DllReferencePlugin 使用 dll 文件</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 单独配置在一个文件中</span>
<span class="token comment">// webpack.dll.conf.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 想统一打包的类库</span>
    <span class="token literal-property property">vendor</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].dll.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&quot;[name]-[hash]&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// name 必须和 output.library 一致</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name]-[hash]&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// 该属性需要与 DllReferencePlugin 中一致</span>
      <span class="token literal-property property">context</span><span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;[name]-manifest.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>然后我们需要执行这个配置文件生成依赖文件，接下来我们需要使用 DllReferencePlugin 将依赖文件引入项目中</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// webpack.conf.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...省略其他配置</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">context</span><span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
      <span class="token comment">// manifest 就是之前打包出来的 json 文件</span>
      <span class="token literal-property property">manifest</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./dist/vendor-manifest.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="9"><li>一些小的优化点</li></ol> <p>我们还可以通过一些小的优化点来加快打包速度</p> <ul><li>resolve.extensions：用来表明文件后缀列表，默认查找顺序是 ['.js', '.json']，如果你的导入文件没有添加后缀就会按照这个顺序查找文件。我们应该尽可能减少后缀列表长度，然后将出现频率高的后缀排在前面</li> <li>resolve.alias：可以通过别名的方式来映射一个路径，能让 Webpack 更快找到路径</li></ul> <p><strong>小结：</strong></p> <ul><li>webpack 优化构建速度（可用于生产）
<ul><li>优化 babel-loader (生产环境缓存无所谓，只用在开发环境就可以。include exclude 必须要使用)</li> <li>IgnorePlugin</li> <li>noParse</li> <li>happyPack(多进程打包)</li> <li>ParallelUglifyPlugin （多进程压缩 JS，必须生产环境，开发环境没必要压缩代码）</li></ul></li> <li>webpack 优化构建速度（不用于生产环境）
<ul><li>自动刷新</li> <li>热更新</li> <li>DllPlugin</li></ul></li></ul> <h3 id="webpack-性能优化-产出代码"><a href="#webpack-性能优化-产出代码" class="header-anchor">#</a> webpack 性能优化 - 产出代码</h3> <p>解决思路：</p> <ol><li>体积更小</li> <li>合理分包，不重复加载</li> <li>执行速度更快、内存使用更小</li></ol> <p>方案：</p> <ol><li>小图片 base64 编码</li> <li>bundle 加 hash</li> <li>懒加载（按需加载）</li> <li>提取公共代码 参考 Code Splitting</li> <li>IngorePlugin</li> <li>使用 CDN 加速</li> <li>使用 production
<ul><li>自动开启代码压缩</li> <li>Vue React 等 会自动删除掉调试代码（如开发环境的 warning）</li> <li>启用 Tree-Shaking
<ul><li>ES6 Module 才能让 tree-shaking 生效。 commonjs 不行</li></ul></li></ul></li> <li>合理使用 SourceMap(不要太详细，配置合适的即可)</li> <li>结合 Stats 分析打包结果</li> <li>Node， Npm/Yarn 更新到最新版本</li> <li>Plugin 尽可能精简可靠</li> <li>resolve 参数合理配置</li> <li>Scope Hosting（Scope Hoisting 会分析出模块之间的依赖关系，尽可能的把打包出来的模块合并到一个函数中去。）
<ul><li>代码体积更小</li> <li>创建函数作用域更少</li> <li>代码可读性更好</li></ul></li></ol> <p>比如我们希望打包两个文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// test.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./test.js&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>对于这种情况，我们打包出来的代码会类似这样</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token comment">/* 0 */</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* 1 */</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>但是如果我们使用 Scope Hoisting 的话，代码就会尽可能的合并到一个函数中去，也就变成了这样的类似代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token comment">/* 0 */</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>这样的打包方式生成的代码明显比之前的少多了。如果在 Webpack4 中你希望开启这个功能，只需要启用 <code>optimization.concatenateModules</code> 就可以了。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">concatenateModules</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>配置：</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/biezhuawpo.png" alt="输入图片说明"></p> <h3 id="前端代码为何要进行构建和打包"><a href="#前端代码为何要进行构建和打包" class="header-anchor">#</a> 前端代码为何要进行构建和打包?</h3> <ul><li>体积更小（Tree-Shaking、压缩、合并），加载更快</li> <li>能够编译高级语言或语法（TS、ES6+、模块化、SCSS）</li> <li>兼容性和错误检查（Polyfill、postcss、eslint）</li></ul> <h4 id="研发流程方面"><a href="#研发流程方面" class="header-anchor">#</a> 研发流程方面：</h4> <ul><li>统一，高效的开发环境</li> <li>统一的构建流程和产出标准</li> <li>集成公司构建规范（提测、上线等）</li></ul> <h3 id="plugin-与-loader-的区别-2"><a href="#plugin-与-loader-的区别-2" class="header-anchor">#</a> Plugin 与 loader 的区别？</h3> <h4 id="loader-3"><a href="#loader-3" class="header-anchor">#</a> loader</h4> <ul><li><p>loader 模块转换器， 如 less &gt; css</p> <p>loader 是一个打包方案，它是针对于某一个特定类型的文件，webpack 该如何进行打包。本身 webpack 是不知道对于一些文件（jpg，txt，excel）该如何处理的，但是 loader 知道。 所以 webpack 去求助 loader 就可以啦。</p></li> <li><p>Plugin</p> <p>plugin 扩展插件，如 HtmlWebpackPlugin</p> <p>在我们做打包的时候， 在某一个具体时刻上。 比如说， 当我打包结束后，我要自动生成一个 html 文件， 这时候我们就可以使用一个 html-webpack-plugin 的插件。它会在打包结束后生成 html 文件。</p> <p>Plugin 可以在我们打包过程的某个时刻想做一些事情。</p></li></ul> <h3 id="常见-loader-有哪些"><a href="#常见-loader-有哪些" class="header-anchor">#</a> 常见 loader 有哪些？</h3> <ol><li><p>file-loader</p> <p>打包图片文件，先将文件转移到打包目录下，再将 dist 中的文件路径返回给 index.js。</p></li> <li><p>url-loader</p> <p>可以通过图片大小来判断是使用 base64 格式图片还是直接打包成一个图片资源文件。</p></li> <li><p>css-loader</p> <p>帮我们分析出几个 css 文件的引入关系， 最终将这些 css 文件合并成一段 css。</p></li> <li><p>style-loader</p> <p>再得到 css-loader 生成的内容后， 会把这段代码挂载到 html 的 head 部分。</p></li> <li><p>sass-loader</p> <p>sass 文件打包</p></li> <li><p>postcss-loader</p> <p>自动加厂商前缀</p></li> <li><p>babel-loader</p> <p>babel 与 webpack 沟通的桥梁</p></li> <li><p>ts-loader</p> <p>TypeScript 的打包配置</p></li> <li><p>eslint-loader</p> <p>可以使团队统一使用一套 eslint</p></li></ol> <h3 id="常见-plugin-有哪些"><a href="#常见-plugin-有哪些" class="header-anchor">#</a> 常见 plugin 有哪些？</h3> <ol><li>html-webpack-plugin 会在打包结束的时刻， 自动生成一个 html 文件， 并把打包生成的 js 自动注入到这个 html 文件中。</li> <li>clean-webpack-plugin 打包流程执行前清空 dist 目录</li> <li>webpack.HotModuleReplacementPlugin 模块热更新</li> <li>webpack.IgnorePlugin 忽略无用文件</li> <li>webpack-bundle-analyzer 打包分析</li> <li>happypack 多进程打包</li> <li>webpack-parallel-uglify-plugin 多进程压缩 JS</li> <li>mini-css-extract-plugin 将 CSS 提取为独立的文件</li> <li>optimize-css-assets-webpack-plugin 压缩 css 代码</li> <li>workbox-webpack-plugin 实现 PWA，是一种强缓存技术</li> <li>add-asset-html-webpack-plugin 将 JavaScript 或 CSS 资源添加到 html-webpack-plugin 生成的 HTML 中</li> <li>webpack.DllPlugin 我们引入了一个 lodash 库， 我们知道这个库的文件它是不会变的， 但是每次打包都会打包它， 我们可以让它只在第一次打包， 下次就不打包了。</li></ol> <h3 id="babel-和-webpack-的区别"><a href="#babel-和-webpack-的区别" class="header-anchor">#</a> babel 和 webpack 的区别</h3> <ul><li>babel JS 新语法编译工具， 不关心模块化</li> <li>webpack 打包构建工具， 是多个 loader plugin 的集合</li></ul> <h4 id="如何产出一个-lib"><a href="#如何产出一个-lib" class="header-anchor">#</a> 如何产出一个 lib？</h4> <p>output.library</p> <p><img src="https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/output.png" alt="输入图片说明"></p> <h3 id="babel-polyfill-和-babel-runtime-的区别"><a href="#babel-polyfill-和-babel-runtime-的区别" class="header-anchor">#</a> babel-polyfill 和 babel-runtime 的区别？</h3> <ul><li>babel-polyfill 会污染全局</li> <li>babel-runtime 不会污染全局</li> <li>产出第三方 lib 要用 babel-rumtime</li></ul> <h3 id="webpack-如何实现懒加载"><a href="#webpack-如何实现懒加载" class="header-anchor">#</a> webpack 如何实现懒加载？</h3> <ul><li>import()</li> <li>结合 Vue React 异步组件</li> <li>结合 Vue-router React-router 异步加载路由</li></ul> <h3 id="为何-proxy-不能被-polyfill"><a href="#为何-proxy-不能被-polyfill" class="header-anchor">#</a> 为何 Proxy 不能被 Polyfill？</h3> <p>我们先看一下那些可以 Polyfill</p> <ul><li>Class 可以用 function 模拟</li> <li>Promise 可以用 callback 来模拟</li> <li>但 Proxy 的功能用 Object.defineProperty 无法模拟</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://gitee.com/l544402029/blog/edit/gh-pages/面试题库/Webpack.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/面试题库/Vue3.html" class="prev">
        Vue3
      </a></span> <span class="next"><a href="/blog/面试题库/Node.js.html">
        Node.js
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.619266e3.js" defer></script><script src="/blog/assets/js/2.f827b574.js" defer></script><script src="/blog/assets/js/35.320e4046.js" defer></script>
  </body>
</html>
