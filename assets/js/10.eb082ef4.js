(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{429:function(s,t,a){"use strict";a.r(t);var e=a(65),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"node-js从零开发web-server博客项目-前端晋升全栈工程师必备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js从零开发web-server博客项目-前端晋升全栈工程师必备"}},[s._v("#")]),s._v(" Node.js从零开发Web Server博客项目 前端晋升全栈工程师必备")]),s._v(" "),a("h2",{attrs:{id:"node-js用途"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js用途"}},[s._v("#")]),s._v(" Node.js用途")]),s._v(" "),a("p",[s._v("Node.js是一个JavaScript的运行环境。它一般有两个用途：")]),s._v(" "),a("ol",[a("li",[s._v("运行在服务器， 作为web server")]),s._v(" "),a("li",[s._v("运行在本地， 作为打包、构建工具。")])]),s._v(" "),a("h2",{attrs:{id:"node-js介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js介绍"}},[s._v("#")]),s._v(" Node.js介绍")]),s._v(" "),a("h3",{attrs:{id:"下载-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载-安装"}},[s._v("#")]),s._v(" 下载 & 安装")]),s._v(" "),a("h4",{attrs:{id:"普通安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#普通安装"}},[s._v("#")]),s._v(" 普通安装")]),s._v(" "),a("p",[s._v("直接在官网下载即可"),a("a",{attrs:{href:"https://nodejs.org/en/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node.js官网"),a("OutboundLink")],1)]),s._v(" "),a("h4",{attrs:{id:"使用nvm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用nvm"}},[s._v("#")]),s._v(" 使用nvm")]),s._v(" "),a("p",[s._v("nvm， node.js版本管理工具， 可切换多个node.js版本")]),s._v(" "),a("ul",[a("li",[s._v("mac os  使用"),a("code",[s._v("brew install nvm")]),s._v("进行安装")])]),s._v(" "),a("p",[s._v("在"),a("a",{attrs:{href:"https://brew.sh",target:"_blank",rel:"noopener noreferrer"}},[s._v("brew官网"),a("OutboundLink")],1),s._v("复制首页代码， 去命令行粘贴运行。安装完之后执行"),a("code",[s._v("brew install nvm")]),s._v("。")]),s._v(" "),a("ul",[a("li",[s._v("windows, github 中搜索nvm-windows， 有下载地址。")])]),s._v(" "),a("h5",{attrs:{id:"nvm命令-工作中常用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nvm命令-工作中常用"}},[s._v("#")]),s._v(" nvm命令(工作中常用)：")]),s._v(" "),a("p",[s._v("nvm(node virsion menage) 可以安装多个node，并切换")]),s._v(" "),a("p",[a("code",[s._v("nvm list")]),s._v(" 查看所有node版本")]),s._v(" "),a("p",[a("code",[s._v("nvm install v10.13.0")]),s._v(" 安装指定版本")]),s._v(" "),a("p",[a("code",[s._v("nvm use --delete-prefix 10.13.0")]),s._v(" 切换到指定版本")]),s._v(" "),a("p",[s._v("如果本地安装了node 需要删掉后重新装nvm 再安装node，这样才能控制全部版本\n否则会报错：\nnode v--delete-prefix.0.0 (64-bit) is not installed.")]),s._v(" "),a("h3",{attrs:{id:"node-js和javascript的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js和javascript的区别"}},[s._v("#")]),s._v(" Node.js和JavaScript的区别")]),s._v(" "),a("p",[s._v("首先写JavaScript和Node.js必须遵守ECMAScript规范。")]),s._v(" "),a("p",[s._v("ECMAScript定义了语法， 保存变量定义， 循环， 判断， 函数， 原型和原型链， 作用域和闭包， 异步。")]),s._v(" "),a("p",[s._v("但是ECMAScript只定义了语法，不能进行以下操作：")]),s._v(" "),a("ul",[a("li",[s._v("不能操作DOM， 不能监听事件， 不能发送ajax请求")]),s._v(" "),a("li",[s._v("不能处理http请求， 不能操作文件")]),s._v(" "),a("li",[s._v("即， 只有ECMAScript， 几乎做不了任何实际的项目。")])]),s._v(" "),a("h4",{attrs:{id:"javascript"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#javascript"}},[s._v("#")]),s._v(" JavaScript")]),s._v(" "),a("p",[s._v("使用了ECMAScript语法规范， 外加Web API， 缺一不可。WEB API包括DOM操作， BOM操作， 事件绑定， Ajax等。 两者结合， 即可完成 浏览器端的任何操作。")]),s._v(" "),a("h4",{attrs:{id:"node-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js"}},[s._v("#")]),s._v(" Node.js")]),s._v(" "),a("p",[s._v("使用了ECMAScript语法规范， 外加Node.js API， 缺一不可。Node.js API包括http, 处理文件等。具体参考"),a("a",{attrs:{href:"http://node.js.cn/api/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node.js API "),a("OutboundLink")],1),s._v(" 两者结合， 即可完成 Server端的任何操作。")]),s._v(" "),a("h3",{attrs:{id:"common-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#common-js"}},[s._v("#")]),s._v(" common.js")]),s._v(" "),a("p",[s._v("node应用由模块组成，采用的commonjs模块规范。每一个文件就是一个模块，拥有自己独立的作用域，变量，以及方法等，对其他的模块都不可见。CommonJS规范规定，每个模块内部，module变量代表当前模块。这个变量是一个对象，它的exports属性（即module.exports）是对外的接口。加载某个模块，其实是加载该模块的module.exports属性。require方法用于加载模块。")]),s._v(" "),a("h4",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),a("p",[s._v("a.js")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("function add (a,b){\n  return a+b\n}\n\nmodule.exports = add\n")])])]),a("p",[s._v("b.js")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const add = require('./a')\n\nconst sum = add(10,20)\n\nconsole.log(sum);\n")])])]),a("h4",{attrs:{id:"引入多个"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引入多个"}},[s._v("#")]),s._v(" 引入多个")]),s._v(" "),a("p",[s._v("a.js")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("function add (a,b){\n  return a+b\n}\n\nfunction mul (a,b){\n  return a*b\n}\n\n\nmodule.exports = {\n  add,\n  mul\n}\n")])])]),a("p",[s._v("b.js")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("add"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("mul"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" sum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" sum2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mul")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("sum2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"前端与server端的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端与server端的区别"}},[s._v("#")]),s._v(" 前端与Server端的区别")]),s._v(" "),a("p",[s._v("server开发和前端开发的区别： 语言和环境工程思维的不同。")]),s._v(" "),a("p",[s._v("前端开发： 每个客户端 对接一个server端（可能不止一台服务器，可能是一个集群）。前端开发的代码是通过server端下载到本地（客户端），然后在客户端浏览器执行的。")]),s._v(" "),a("p",[s._v("server开发： 它要承接很多客户端的请求，很多请求到了server端，然后server端去处理。")]),s._v(" "),a("p",[s._v("总结的区别：")]),s._v(" "),a("ol",[a("li",[s._v("服务稳定性（服务端不可挂）")]),s._v(" "),a("li",[s._v("考虑内存和CPU （优化、扩展）")]),s._v(" "),a("li",[s._v("日志记录（程序运行的报告，没有这个，对程序运行相当于盲人一样~）")]),s._v(" "),a("li",[s._v("安全")]),s._v(" "),a("li",[s._v("集群和服务拆分")])]),s._v(" "),a("h2",{attrs:{id:"技术方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#技术方案"}},[s._v("#")]),s._v(" 技术方案")]),s._v(" "),a("h3",{attrs:{id:"接口设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#接口设计"}},[s._v("#")]),s._v(" 接口设计")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220805084925165.png",alt:"image-20220805084925165"}})]),s._v(" "),a("h2",{attrs:{id:"http概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http概述"}},[s._v("#")]),s._v(" http概述")]),s._v(" "),a("p",[s._v("问题： 从浏览器输入url到页面渲染都发生了什么？")]),s._v(" "),a("p",[s._v("DNS解析获取到ip地址 -> 建立tcp连接 -> 发送http请求 -> server接受http请求，并处理请求返回数据 -> 客户端接受数据并处理数据（渲染页面，执行js）\n中间涉及到到IP协议，ARP协议，OSPF协议")]),s._v(" "),a("ol",[a("li",[s._v("IP协议：指定出发地（你的pc）和目的地（服务器）")]),s._v(" "),a("li",[s._v("ARP协议：找到所有路径")]),s._v(" "),a("li",[s._v("OSPF协议：找到最优路径请求资源")])]),s._v(" "),a("h2",{attrs:{id:"搭建开发环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建开发环境"}},[s._v("#")]),s._v(" 搭建开发环境")]),s._v(" "),a("h3",{attrs:{id:"安装nodemon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装nodemon"}},[s._v("#")]),s._v(" 安装nodemon")]),s._v(" "),a("p",[s._v("nodemon 可以实现自动重启")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i nodemon cross-env -D \n")])])]),a("p",[s._v("安装完成之后在package.json的script命令中输入以下内容")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('"dev":"cross-env NODE_ENV=dev nodemon ./bin/www.js"\n')])])]),a("p",[s._v("之后直接在命令行输入"),a("code",[s._v("npm run dev")]),s._v("即可。")]),s._v(" "),a("p",[a("code",[s._v("NODE_ENV=dev")]),s._v("指的是执行环节是开发环境。在代码中可以通过"),a("code",[s._v("process.env.NODE_ENV")]),s._v("获取到环境变量。")]),s._v(" "),a("h2",{attrs:{id:"node-js模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js模块"}},[s._v("#")]),s._v(" Node.js模块")]),s._v(" "),a("h3",{attrs:{id:"获取query"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取query"}},[s._v("#")]),s._v(" 获取query")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const querystring = require('querystring')\nreq.query = querystring.parse(url.split('?')[0])\n")])])]),a("h3",{attrs:{id:"文件操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件操作"}},[s._v("#")]),s._v(" 文件操作")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const fs = require('fs')\n")])])]),a("h3",{attrs:{id:"获取文件路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取文件路径"}},[s._v("#")]),s._v(" 获取文件路径")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const path = require('path')\nconst fileName = path.resolve(__dirname,'file','a.json')\n")])])]),a("p",[s._v("__diraname：当前目录， file：文件夹， a.json：文件")]),s._v(" "),a("h2",{attrs:{id:"数据库操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库操作"}},[s._v("#")]),s._v(" 数据库操作")]),s._v(" "),a("p",[s._v("首先需要下载 MySql 和 SQLWorkBench。")]),s._v(" "),a("p",[s._v("以下为SQLWorkBench内操作。")]),s._v(" "),a("h2",{attrs:{id:"查看数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看数据库"}},[s._v("#")]),s._v(" 查看数据库")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("show databases;\n")])])]),a("p",[a("img",{attrs:{src:"https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220805085004732.png",alt:"image-20220805085004732"}})]),s._v(" "),a("h3",{attrs:{id:"使用数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用数据库"}},[s._v("#")]),s._v(" 使用数据库")]),s._v(" "),a("p",[s._v("我们想要操作数据库首先要执行：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("use blog;\n")])])]),a("p",[s._v("blog指的是数据库名称。")]),s._v(" "),a("p",[s._v("显示所有数据库表：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("show tables;\n")])])]),a("h4",{attrs:{id:"增加数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增加数据"}},[s._v("#")]),s._v(" 增加数据")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("insert into users(username,`password`,realname) values('zhangsan','123','张三');\n")])])]),a("p",[s._v("如果遇到SQL关键字， 我们可以用反引号把它包起来， 如:password")]),s._v(" "),a("h4",{attrs:{id:"查询数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询数据库"}},[s._v("#")]),s._v(" 查询数据库")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("-- select * from users;\n")])])]),a("p",[s._v("select指的就是查询， "),a("code",[s._v("*")]),s._v("指的是我把所有的列都查出来。 user指的是表名。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select id,username from users;\n")])])]),a("p",[s._v("也可以只查询id，和username。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where username='zhangsan';\n")])])]),a("p",[s._v("增加了查询条件， 只查询username是张三的数据。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where username='zhangsan' and `password`='123';\n")])])]),a("p",[s._v("查询username='zhangsan'并且password='123' 的数据。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where username='zhangsan' or `password`='123';\n")])])]),a("p",[s._v("查询username='zhangsan'或者password='123' 的数据。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where username like '%zhang%';\n")])])]),a("p",[s._v("只模糊匹配查询username字段有zhang的数据。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where password like '%1%' order by id;\n")])])]),a("p",[s._v("根据id正序排序。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where password like '%1%' order by id desc;\n")])])]),a("p",[s._v("根据id倒序排序。")]),s._v(" "),a("h4",{attrs:{id:"更新数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新数据库"}},[s._v("#")]),s._v(" 更新数据库")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("update users set realname='李四2';\n")])])]),a("p",[s._v("把users表的所有realname都改成李四2。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("update users set realname='李四2' where username='lisi';\n")])])]),a("p",[s._v("把users表username=lisi的用户realname改成李四2")]),s._v(" "),a("p",[s._v("如果遇到报错可以执行以下语句：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SET SQL_SAFE_UPDATES=0;\n")])])]),a("h4",{attrs:{id:"删除数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除数据"}},[s._v("#")]),s._v(" 删除数据")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("delete from users where username='lisi';\n")])])]),a("p",[s._v("删除username为lisi的数据。")]),s._v(" "),a("p",[s._v("一般情况下我们不会真正的删除数据， 而是在表格增加一个字段"),a("code",[s._v("state")]),s._v("， 用它来进行判断是否有数据， 也就是一个软删除的技术。（state设置为0或1控制是否删除） 一般它的默认值设为1。")]),s._v(" "),a("p",[s._v("这样做的好处就是它是可以恢复的。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where state='1';\nupdate users set state='0' where username='lisi';\n")])])]),a("p",[s._v("将username=lisi的数据state改为了0， 第一句是查询users表内state为1的数据。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where state<>'0';\n")])])]),a("p",[s._v("如果我们想要使用不等于， 请使用"),a("code",[s._v("<>")]),s._v("小于号和大于号组合，如上。")]),s._v(" "),a("h2",{attrs:{id:"node-js操作数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js操作数据库"}},[s._v("#")]),s._v(" Node.js操作数据库")]),s._v(" "),a("p",[s._v("首先我们需要安装一个插件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i mysql\n")])])]),a("p",[s._v("index.js")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//创建连接对象")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" con "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createConnection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yutong9909'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3306'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'blog'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//开始连接")]),s._v("\ncon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("connect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//执行 sql 语句")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" sql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("insert into blogs(title,content,createtime,author) values('标题C','内容C',1583031695880,'zhangsan');")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v("\ncon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" result")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//关闭连接")]),s._v("\ncon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220805085046072.png",alt:"image-20220805085046072"}})]),s._v(" "),a("p",[s._v("连接数据库报错")]),s._v(" "),a("p",[s._v("解决方案：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("use blog;\nalter user 'root'@'localhost' identified with mysql_native_password by '123456';\nflush privileges;\n")])])]),a("h2",{attrs:{id:"cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[s._v("#")]),s._v(" cookie")]),s._v(" "),a("h4",{attrs:{id:"什么是cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是cookie"}},[s._v("#")]),s._v(" 什么是cookie？")]),s._v(" "),a("ul",[a("li",[s._v("存储在浏览器的一段字符串（最大5kb）")]),s._v(" "),a("li",[s._v("跨域不共享")]),s._v(" "),a("li",[s._v("格式如 K1=V1;K2=V2;K3=V3;因此可以存储结构化数据。")]),s._v(" "),a("li",[s._v("每次发送http请求， 会将请求域的cookie一起发送给server")]),s._v(" "),a("li",[s._v("server可以修改cookie并返回给")]),s._v(" "),a("li",[s._v("浏览器中也可以通过JavaScript修改cookie（有限制）")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220805085114341.png",alt:"image-20220805085114341"}})]),s._v(" "),a("h4",{attrs:{id:"cookie和token的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie和token的区别"}},[s._v("#")]),s._v(" cookie和token的区别？")]),s._v(" "),a("p",[s._v("cookie 是 http 协议的规范，一种标准，即一个工具，你拿 cookie 干嘛都可以，例如课程中我们用 cookie 实现登录。token 是一种业务上的术语，可以理解为密码、秘钥等，不同业务中 token 的格式、使用方式也不同。你可以使用很多种方式来实现 token ，例如 cookie ，http header ，url 参数中，或者 req.body 中。")]),s._v(" "),a("h4",{attrs:{id:"操作cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作cookie"}},[s._v("#")]),s._v(" 操作cookie")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("res.setHeader('Set-Cookie',`username=${data.username}; path=/; httpOnly; expires=${getCookieExpires()}`)\n")])])]),a("p",[s._v("path=/代表在所有路由下都可以访问cookie.\nhttpOnly表示此cookie不可在客户端操作。\nexpires=${getCookieExpires()}设置了cookie过期时间")]),s._v(" "),a("p",[s._v("过期时间函数")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("//获取 cookie 的过期时间\nconst getCookieExpires = () => {\n\tconst d = new Date()\n\td.setTime(d.getTime() + (24 * 60 * 60 * 1000))\n\treturn d.toGMTString()\n}\n")])])]),a("h2",{attrs:{id:"session"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[s._v("#")]),s._v(" session")]),s._v(" "),a("p",[s._v("如果我们只用cookie就会有一个问题， cookie存储的个人信息都是暴露在外面的， 别人可以看到。（如你的手机号， 邮箱，用户名，密码等）。而且你其他平台的用户名及密码也有可能是一样的， 这样的话一旦泄露就十分危险。")]),s._v(" "),a("p",[s._v("第二个cookie存储的信息也是非常显现的， 大约为4kb。太多的信息也有可能放不开。")]),s._v(" "),a("h4",{attrs:{id:"如何解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何解决"}},[s._v("#")]),s._v(" 如何解决？")]),s._v(" "),a("p",[s._v("我们可以在cookie中存储userid，userid可以是一个随机数之类的数字， 非常非常不相关的数字。 server端对应username。我们可以通过一个对象或者集合去查， 查出这个用户名来。")]),s._v(" "),a("p",[a("code",[s._v("session")]),s._v(" 是一个统称， 它的解决方案就是用server端存储用户信息。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220805085144884.png",alt:"image-20220805085144884"}})]),s._v(" "),a("p",[s._v("如上图： 我们只在浏览器中放一个毫无意义的userid就可以了， 即便用户被截获， 他也不知道userid是什么意思。然后到我们的server中呢？ 首先我们的server是足够安全的，因为他不会来回传输。 只要做好足够的限制， 安全就可以了。server端的空间也是足够大的， 里面可以存储很多的信息。")]),s._v(" "),a("h2",{attrs:{id:"redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[s._v("#")]),s._v(" redis")]),s._v(" "),a("p",[s._v("只用session会出现两个问题：")]),s._v(" "),a("ol",[a("li",[s._v("进程内存有限， 访问量过大， 内存激增怎么办？")]),s._v(" "),a("li",[s._v("正式上线运行是多线程， 进程之间内存无法共享")])]),s._v(" "),a("h4",{attrs:{id:"解决方案radis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方案radis"}},[s._v("#")]),s._v(" 解决方案radis")]),s._v(" "),a("ul",[a("li",[s._v("web server 最常用的缓存数据库， 数据存放在内存中")]),s._v(" "),a("li",[s._v("相比 mysql， 访问速度快（内存和硬盘不是一个数量级的）")]),s._v(" "),a("li",[s._v("但是成本更高， 可存储的数据量更小（内存的硬伤）")]),s._v(" "),a("li",[s._v("将web server 和 redis 拆分为两个单独的服务")]),s._v(" "),a("li",[s._v("双方都是独立的， 都是可扩展的（例如都扩展成集群）")]),s._v(" "),a("li",[s._v("（包括 mysql ， 也是一个单独的服务， 也可扩展）")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220805085202784.png",alt:"image-20220805085202784"}})]),s._v(" "),a("h4",{attrs:{id:"为何session适合用-redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为何session适合用-redis"}},[s._v("#")]),s._v(" 为何session适合用 redis?")]),s._v(" "),a("ul",[a("li",[s._v("session 访问频繁， 对性能要求极高。")]),s._v(" "),a("li",[s._v("session 可不考虑断电丢失数据的问题（内存的硬伤）")]),s._v(" "),a("li",[s._v("session 数据量不会太大（相比于mysql中存储的数据）")])]),s._v(" "),a("h4",{attrs:{id:"为何网站数据不适合用redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为何网站数据不适合用redis"}},[s._v("#")]),s._v(" 为何网站数据不适合用redis？")]),s._v(" "),a("ul",[a("li",[s._v("操作频率不是太高（相比于session操作）")]),s._v(" "),a("li",[s._v("断电不能丢失， 必须保留")]),s._v(" "),a("li",[s._v("数据量太大， 内存成本太高")])]),s._v(" "),a("h3",{attrs:{id:"redis安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis安装"}},[s._v("#")]),s._v(" redis安装")]),s._v(" "),a("p",[s._v("https://www.runoob.com/redis/redis-install.html")]),s._v(" "),a("p",[s._v("可参考此网站安装配置。")]),s._v(" "),a("h4",{attrs:{id:"启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("redis-server.exe\n")])])]),a("h4",{attrs:{id:"node-js连接redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js连接redis"}},[s._v("#")]),s._v(" Node.js连接redis")]),s._v(" "),a("p",[s._v("首先我们需要安装一个redis包。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i redis --save\n")])])]),a("h2",{attrs:{id:"nignx代理-和前端联调"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nignx代理-和前端联调"}},[s._v("#")]),s._v(" nignx代理（和前端联调）")]),s._v(" "),a("p",[s._v("一般前端的接口号会与server接口并不一样， 这时候我们需要一个接口进行代理， 使他们访问相同的接口。")]),s._v(" "),a("h3",{attrs:{id:"nignx介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nignx介绍"}},[s._v("#")]),s._v(" nignx介绍")]),s._v(" "),a("ul",[a("li",[s._v("高性能的web服务器， 开源免费")]),s._v(" "),a("li",[s._v("一般用于做静态服务，负载均衡")]),s._v(" "),a("li",[s._v("还有反向代理")])]),s._v(" "),a("h4",{attrs:{id:"什么叫做静态服务呢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么叫做静态服务呢"}},[s._v("#")]),s._v(" 什么叫做静态服务呢？")]),s._v(" "),a("p",[s._v("比如说我们做了一个CDN， 就是那种网上放图片，放css文件，放js文件， 或者放静态的集群文件， html文件。只要是服务端不需要解析直接返回那种静态文件都可以用nginx做一个高性能的静态服务。")]),s._v(" "),a("h3",{attrs:{id:"负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[s._v("#")]),s._v(" 负载均衡")]),s._v(" "),a("p",[s._v("比如说我们有一个server的集群，集群有5台机器。其中一台是主机器，流量都在主机器上。剩下的那几台怎么去均分流量，怎么去分摊， 怎么让每个机器能平摊各种流量。以至于我们整个集群的负载能到最高。这也可以通过nginx配置。 它内部的一个模块可以做到这些。它可以做一个入口， 流量来了它分配到不同的机器上去，平均分配。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220805085222095.png",alt:"image-20220805085222095"}})]),s._v(" "),a("h4",{attrs:{id:"反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[s._v("#")]),s._v(" 反向代理")]),s._v(" "),a("p",[s._v("所谓反向代理就是它是对客户端不可见的代理，就叫反向代理。")]),s._v(" "),a("p",[s._v("server端全部涵盖了，客户端控制不了，对客户端来说它是一个黑盒，这样就叫做反向代理。")]),s._v(" "),a("h4",{attrs:{id:"正向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正向代理"}},[s._v("#")]),s._v(" 正向代理")]),s._v(" "),a("p",[s._v("和反向代理相反的是正向代理， 比如我们公司的内网， 我们在家里访问不了，我们需要在本地装一个代理工具，然后才能访问。这属于一个正向代理。浏览器客户端能够控制的代理。")]),s._v(" "),a("h4",{attrs:{id:"nginx使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx使用"}},[s._v("#")]),s._v(" nginx使用")]),s._v(" "),a("p",[s._v("首先需要进行安装， "),a("a",{attrs:{href:"http://nginx.org/en/download.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("niginx：下载"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("测试配置文件格式是否正确：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nginx -t\n")])])]),a("p",[s._v("启动nginx")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("start nginx\n")])])]),a("p",[s._v("重启nginx")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nginx.exe -s reload\n")])])]),a("p",[s._v("停止")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nginx -s stop\n")])])]),a("p",[s._v("重新打开日志文件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nginx.exe -s reopen\n")])])]),a("p",[s._v("查看nginx版本")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nginx -v\n")])])]),a("h5",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),a("p",[s._v("打开nginx-1.16.1\\conf\\nginx.conf文件进行配置")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\t    location / {\n            proxy_pass: http://localhost:8001;\n        }\n\t\tlocation /api/ {\n\t\t\tproxy_pass: http://lcoalhost:8000;\n\t\t\tproxy_set_header HOST $host;\n\t\t}\n")])])]),a("p",[s._v("/表示根目录， 代理到8001。 8001是前端端口\n/api标识api接口  代理到8000. 8000是server端端口")]),s._v(" "),a("p",[s._v("后端端口代理需要把host传进去， 因为此时他的host不一样了。")]),s._v(" "),a("p",[s._v("此时在访问http://localhost:8080/（前端）和 http://localhost:8080/api/blog/list（server端）就可以了")]),s._v(" "),a("h2",{attrs:{id:"安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全"}},[s._v("#")]),s._v(" 安全")]),s._v(" "),a("h3",{attrs:{id:"sql注入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql注入"}},[s._v("#")]),s._v(" sql注入")]),s._v(" "),a("p",[s._v("最原始，最简单的攻击， 从有了web2.0就有了sql注入攻击。")]),s._v(" "),a("p",[s._v("攻击方式： 输入一个sql片段， 最终拼接成一段攻击代码")]),s._v(" "),a("p",[s._v("预防措施： 使用mysql的escape 函数处理输入内容即可")]),s._v(" "),a("p",[s._v("如下：")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    exec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("escape")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("escape\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("使用：")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" exec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" escape "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../db/mysql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("login")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    username "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("escape")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    password "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("escape")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" sql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\n        select username, realname from users where username='")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("' and password='")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\n    ")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" rows"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    login\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h3",{attrs:{id:"xss攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss攻击"}},[s._v("#")]),s._v(" xss攻击")]),s._v(" "),a("p",[s._v("所谓xss攻击指的就是在网页中写入一段js代码以获取用户信息。")]),s._v(" "),a("p",[s._v("如我新建了一篇博客， 在博客内容中有以下一段js代码，")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<script>console.log(document.cookie);<\/script>\n")])])]),a("p",[s._v("然后我创建成功后， 别人看到这篇博客我就能获取它的cookie信息， 并发送到我的服务器。")]),s._v(" "),a("h4",{attrs:{id:"预防"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预防"}},[s._v("#")]),s._v(" 预防")]),s._v(" "),a("p",[s._v("首先我们需要安装一个插件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i xss\n")])])]),a("p",[s._v("直接在代码中引入使用")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const xss = require('xss')\n")])])]),a("p",[s._v("使用：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("title = xss(escape(title)) \n")])])]),a("p",[s._v("可以先使用xss后在使用escape函数。")]),s._v(" "),a("h3",{attrs:{id:"密码加密"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#密码加密"}},[s._v("#")]),s._v(" 密码加密")]),s._v(" "),a("ul",[a("li",[s._v("万一数据库被攻破， 最不应该泄露的就是用户信息。")]),s._v(" "),a("li",[s._v("攻击方式： 获取用户名和密码， 再去尝试登录其他系统")]),s._v(" "),a("li",[s._v("预防措施： 将密码加密， 即便拿到密码也不知道明文")])]),s._v(" "),a("p",[s._v("cryp.js")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" crypto "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'crypto'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//密匙")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECRET_KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'WJiol_8776#'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//md5 加密")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("md5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("content")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" md5 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createHash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'md5'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" md5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("digest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hex'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//加密函数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("genPassword")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" str "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("password=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("&key=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECRET_KEY")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("md5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    genPassword\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("登录时使用：")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" genPassword "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../utils/cryp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//生成加密密码")]),s._v("\npassword "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("genPassword")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npassword "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("escape")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//防止xss攻击")]),s._v("\n")])])]),a("h3",{attrs:{id:"网站运行流程图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网站运行流程图"}},[s._v("#")]),s._v(" 网站运行流程图")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220805085249591.png",alt:"image-20220805085249591"}})]),s._v(" "),a("h2",{attrs:{id:"express"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#express"}},[s._v("#")]),s._v(" express")]),s._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("首先需要安装脚手架")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i express-generator -g\n")])])]),a("p",[s._v("创建项目：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("express blog-express\n")])])]),a("p",[s._v("进入目录安装npm包")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd blog-express\nnpm i\n")])])]),a("p",[s._v("启动")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm start\n")])])]),a("h3",{attrs:{id:"登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[s._v("#")]),s._v(" 登录")]),s._v(" "),a("p",[s._v("使用 express-session 和 connect-redis")]),s._v(" "),a("p",[s._v("req.session保存登录信息， 登陆校验做成 express 中间件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i express-session\n")])])]),a("h4",{attrs:{id:"使用-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-2"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const session = require('express-session');\n\napp.use(session({\n  secret: 'WJiol#23123_',\n  cookie: {\n    // path: '/',  //默认配置\n    // httpOnly: true,    //默认配置\n    maxAge: 24 * 60 * 60 * 1000\n  }\n}))\n")])])]),a("h3",{attrs:{id:"使用redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用redis"}},[s._v("#")]),s._v(" 使用redis")]),s._v(" "),a("p",[s._v("首先安装以下两个插件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i redis connect-redis --save\n")])])]),a("p",[s._v("app.js")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" session "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'express-session'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" RedisStore "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'connect-redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("session"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" redisClient "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./db/redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" sessionStore "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisStore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("client")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redisClient\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("session")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("secret")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'WJiol#23123_'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//秘钥，不可暴露")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("resave")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("saveUninitialized")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("cookie")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("maxAge")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("store")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" sessionStore"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//redis存储")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("redis.js")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" redis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REDIS_CONF")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../conf/db'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//创建客户端")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" redisClient "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createClient")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REDIS_CONF")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REDIS_CONF")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nredisClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redisClient\n")])])]),a("h3",{attrs:{id:"记录日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#记录日志"}},[s._v("#")]),s._v(" 记录日志")]),s._v(" "),a("p",[s._v("使用脚手架推荐的morgan")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const ENV = process.env.NODE_ENV\nif (ENV !== 'production') {\n  //开发测试环境\n  app.use(logger('dev'));\n} else {\n  // 线上环境\n  const logFileName = path.join(__dirname,'logs','access.log')\n  const writeStream = fs.createWriteStream(logFileName, {\n    flags: 'a'\n  })\n  app.use(logger('combined', {\n    stream: writeStream\n  }));\n}\n")])])]),a("h3",{attrs:{id:"express中间件原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#express中间件原理"}},[s._v("#")]),s._v(" express中间件原理")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog-picgo-typora.oss-cn-hangzhou.aliyuncs.com/image-20220805085316017.png",alt:"image-20220805085316017"}})]),s._v(" "),a("h2",{attrs:{id:"koa2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#koa2"}},[s._v("#")]),s._v(" KOA2")]),s._v(" "),a("h3",{attrs:{id:"async-await要点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#async-await要点"}},[s._v("#")]),s._v(" async/await要点")]),s._v(" "),a("ol",[a("li",[s._v("await 后面可以追加 promise对象， 获取 resolve 的值")]),s._v(" "),a("li",[s._v("await 必须包裹在 async 函数里面")]),s._v(" "),a("li",[s._v("async 函数执行返回的也是一个promise对象")]),s._v(" "),a("li",[s._v("try-catch 截获 promise 中 reject 的值")])]),s._v(" "),a("h3",{attrs:{id:"安装-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-2"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("首先安装脚手架工具")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i koa-generator -g\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("koa2 blog-koa2\n")])])]),a("h3",{attrs:{id:"登录-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录-2"}},[s._v("#")]),s._v(" 登录")]),s._v(" "),a("p",[s._v("基于 koa-generic-session 和 koa-redis")]),s._v(" "),a("p",[s._v("需要安装3个插件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i koa-generic-session koa-redis redis\n")])])]),a("p",[s._v("app.js")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" session "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'koa-generic-session'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" redisStore "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'koa-redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//session 配置")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'WJiol#23123_'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("session")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//配置cookie")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("cookie")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("httpOnly")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("maxAge")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//配置 redis")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("store")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("redisStore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("all")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REDIS_CONF")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REDIS_CONF")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// routes")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("allowedMethods")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("allowedMethods")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("blog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" blog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("allowedMethods")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("allowedMethods")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("session一定要在routes前进行配置")]),s._v(" "),a("h3",{attrs:{id:"koa2记录日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#koa2记录日志"}},[s._v("#")]),s._v(" koa2记录日志")]),s._v(" "),a("p",[s._v("安装插件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i koa-morgan --save\n")])])]),a("p",[s._v("引入")]),s._v(" "),a("p",[s._v("app.js")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'fs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" morgan "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'koa-morgan'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("app.js")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ENV")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ENV")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'production'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//开发测试环境")]),s._v("\n  app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("morgan")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//线上环境")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" logFileName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'logs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'access.log'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" writeStream "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createWriteStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("logFileName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("morgan")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'combined'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("stream")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" writeStream\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),a("h2",{attrs:{id:"上线与配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上线与配置"}},[s._v("#")]),s._v(" 上线与配置")]),s._v(" "),a("h3",{attrs:{id:"pm2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2"}},[s._v("#")]),s._v(" pm2")]),s._v(" "),a("h4",{attrs:{id:"下载安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载安装"}},[s._v("#")]),s._v(" 下载安装")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm install pm2 -g\n")])])]),a("p",[s._v("查看版本")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 --version\n")])])]),a("h4",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("p",[s._v("多种启动方式， 后面跟配置文件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 start ...\n")])])]),a("p",[s._v("pm2进程列表")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 list\n")])])]),a("p",[s._v("重启进程")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 restart 0\n")])])]),a("p",[s._v("或者")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 restart app\n")])])]),a("p",[s._v("后面跟id或者进程名")]),s._v(" "),a("p",[s._v("停止进程")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 stop app/id\n")])])]),a("p",[s._v("删除进程")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 delete app/id\n")])])]),a("p",[s._v("查看基本信息")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 info app/id\n")])])]),a("p",[s._v("查看进程日志")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 log app/id\n")])])]),a("p",[s._v("监控cpu和内存信息")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 monit app/id\n")])])]),a("h4",{attrs:{id:"常用配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用配置"}},[s._v("#")]),s._v(" 常用配置")]),s._v(" "),a("p",[s._v("pm2.conf.json")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('{\n    "apps": {\n        "name": "pm2-test-server",\n        "script": "bin/www",\n        "watch": true,\n        "ignore_watch": [\n            "node_modules",\n            "logs"\n        ],\n        "instances": 4,\n        "error_file": "logs/err.log",\n        "out_file": "logs/out.log",\n        "log_date_format": "YYYY-MM-DD HH:mm:ss"\n    }\n}\n')])])]),a("p",[s._v("name: pm2-test-server  app名称")]),s._v(" "),a("p",[s._v("script: app.js 启动文件")]),s._v(" "),a("p",[s._v("watch: true  上线自动重启。 建议设置为false， 再自己手动重启")]),s._v(" "),a("p",[s._v('innore_watch ： [\n"logs"\n]\n即使logs文件夹内有文件改动也不监听， 不重启')]),s._v(" "),a("p",[s._v('"instances": 4, 使用4核运行')]),s._v(" "),a("p",[s._v('error_file : "logs/err.log"  错误日志存放 / console.error()')]),s._v(" "),a("p",[s._v('out_file : "logs/out.log" 日志存放 / console.log()')]),s._v(" "),a("p",[s._v('log_date_format :"YYYY-MM-DD HH:mm:ss"  每条日志增加时间戳')])])}),[],!1,null,null,null);t.default=n.exports}}]);